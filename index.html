<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Convivencia - Versi√≥n Final RTDB</title>
    
    <!-- Firebase SDK para RTDB -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
        }

        body { 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
        }

        header { 
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white; 
            padding: 30px; 
            border-radius: 15px; 
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 15px 15px 0 0;
            overflow: hidden;
            margin-bottom: 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background: var(--light);
            border-right: 1px solid #ddd;
            transition: all 0.3s;
            font-weight: 600;
        }

        .tab:hover {
            background: #e3e8ed;
        }

        .tab.active {
            background: white;
            color: var(--primary);
            border-bottom: 3px solid var(--secondary);
        }

        .tab.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f8f9fa;
        }

        .tab.disabled:hover {
            background: #f8f9fa;
        }

        .tab-content {
            background: white;
            padding: 30px;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: none;
            animation: fadeIn 0.5s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-left: 5px solid var(--secondary);
        }

        .form-group { 
            margin-bottom: 20px; 
            position: relative;
        }

        label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: 600; 
            color: var(--primary); 
        }

        select, input, button, textarea { 
            width: 100%; 
            padding: 14px; 
            border: 2px solid #e0e6ed; 
            border-radius: 8px; 
            font-size: 16px;
            transition: all 0.3s;
        }

        select:focus, input:focus, textarea:focus { 
            border-color: var(--secondary); 
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        button {
            background: linear-gradient(135deg, var(--success), #219653);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s;
        }

        button:hover { 
            background: linear-gradient(135deg, #219653, #1e8449);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), #2980b9);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #2980b9, #2573a7);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #e67e22);
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #e67e22, #d35400);
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #c0392b);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 14px;
            width: auto;
            margin: 0 5px;
        }

        .student-search-container {
            position: relative;
        }

        #student-search {
            padding-right: 45px;
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 42px;
            color: #7f8c8d;
        }

        .student-list {
            max-height: 200px;
            overflow-y: auto;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            margin-top: 5px;
            display: none;
            background: white;
            z-index: 1000;
            position: absolute;
            width: 100%;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .student-list.active {
            display: block;
        }

        .student-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f1f2f6;
            transition: all 0.2s;
        }

        .student-item:hover {
            background: #f8f9fa;
        }

        .student-item.selected {
            background: #e8f4fc;
            color: var(--secondary);
            font-weight: 600;
        }

        .mediator-levels {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .mediator-card {
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s;
        }

        .mediator-card:hover {
            transform: translateY(-5px);
        }

        .level-1 {
            background: linear-gradient(135deg, #e8f6f3, #d1f2eb);
            border: 2px solid #a3e4d7;
        }

        .level-2 {
            background: linear-gradient(135deg, #e8f4fc, #d1e7f9);
            border: 2px solid #a9cce3;
        }

        .level-3 {
            background: linear-gradient(135deg, #fef9e7, #fcf3cf);
            border: 2px solid #f7dc6f;
        }

        .level-badge {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .badge-level-1 {
            background: #27ae60;
            color: white;
        }

        .badge-level-2 {
            background: #3498db;
            color: white;
        }

        .badge-level-3 {
            background: #f39c12;
            color: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        th, td { 
            padding: 15px; 
            text-align: left; 
            border-bottom: 1px solid #eee; 
        }

        th { 
            background: var(--primary);
            color: white;
            font-weight: 600;
        }

        tr:hover { 
            background: #f8f9fa; 
        }

        .evaluation-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .evaluation-dimension {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid var(--secondary);
        }

        .slider-container {
            margin-top: 15px;
        }

        .slider-value {
            text-align: center;
            font-weight: bold;
            color: var(--primary);
            font-size: 1.2rem;
            margin-top: 10px;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: var(--secondary);
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-top: 4px solid var(--secondary);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .config-section {
            margin-bottom: 30px;
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
        }

        .config-section:last-child {
            border-bottom: none;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .input-group input {
            flex: 1;
        }

        .editable-table {
            margin: 20px 0;
        }

        .editable-table input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .pin-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 400px;
            margin: 50px auto;
            text-align: center;
        }

        .pin-input-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
        }

        .pin-input {
            width: 60px;
            height: 60px;
            font-size: 2rem;
            text-align: center;
            border: 3px solid var(--secondary);
            border-radius: 10px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .pin-input:focus {
            border-color: var(--success);
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.2);
            outline: none;
        }

        .pin-input.filled {
            background: #e8f6f3;
            border-color: var(--success);
        }

        .pin-input.error {
            border-color: var(--danger);
            background: #fdebd0;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .pin-keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 25px 0;
        }

        .pin-key {
            padding: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            background: var(--light);
            cursor: pointer;
            transition: all 0.3s;
        }

        .pin-key:hover {
            background: var(--secondary);
            color: white;
            transform: translateY(-2px);
        }

        .pin-key.clear {
            background: var(--warning);
            color: white;
        }

        .pin-key.clear:hover {
            background: #e67e22;
        }

        .pin-key.enter {
            background: var(--success);
            color: white;
            grid-column: span 2;
        }

        .pin-key.enter:hover {
            background: #219653;
        }

        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                width: 100%;
            }
            
            .container {
                padding: 10px;
            }
            
            header {
                padding: 20px;
            }
            
            .tab-content {
                padding: 20px;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn-small {
                width: 100%;
                margin: 5px 0;
            }
            
            .pin-input {
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            animation: slideIn 0.3s;
            max-width: 350px;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification.success {
            background: linear-gradient(135deg, var(--success), #219653);
        }

        .notification.error {
            background: linear-gradient(135deg, var(--danger), #c0392b);
        }

        .notification.info {
            background: linear-gradient(135deg, var(--secondary), #2980b9);
        }

        .notification.warning {
            background: linear-gradient(135deg, var(--warning), #e67e22);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            animation: fadeIn 0.3s;
        }

        .modal {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            justify-content: flex-end;
        }

        .config-tabs {
            display: flex;
            border-bottom: 2px solid #eee;
            margin-bottom: 25px;
            overflow-x: auto;
        }

        .config-tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            font-weight: 600;
            color: var(--primary);
            transition: all 0.3s;
        }

        .config-tab:hover {
            background: #f8f9fa;
        }

        .config-tab.active {
            border-bottom: 3px solid var(--secondary);
            color: var(--secondary);
        }

        .config-tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }

        .config-tab-content.active {
            display: block;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }

        .hidden {
            display: none !important;
        }

        .firebase-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .firebase-online {
            background: linear-gradient(135deg, var(--success), #219653);
            color: white;
        }

        .firebase-offline {
            background: linear-gradient(135deg, var(--warning), #e67e22);
            color: white;
        }

        .firebase-error {
            background: linear-gradient(135deg, var(--danger), #c0392b);
            color: white;
        }

        .sync-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .sync-active {
            background: #4cd964;
        }

        .sync-inactive {
            background: #ff3b30;
        }

        /* Sello de agua */
        .watermark {
            position: fixed;
            bottom: 10px;
            right: 10px;
            color: rgba(0, 0, 0, 0.1);
            font-size: 14px;
            font-weight: bold;
            z-index: 9999;
            pointer-events: none;
            user-select: none;
            transform: rotate(-5deg);
            background: rgba(255, 255, 255, 0.3);
            padding: 5px 10px;
            border-radius: 5px;
        }

        /* Logos del header */
        .header-logos {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .logo-left, .logo-right {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 5px;
        }

        .logo-left img, .logo-right img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        /* Nuevos estilos para premios */
        .premios-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .premio-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-top: 4px solid var(--success);
            transition: transform 0.3s;
        }

        .premio-card:hover {
            transform: translateY(-5px);
        }

        .premio-card.oro {
            border-top-color: #ffd700;
            background: linear-gradient(135deg, #fff8dc, #fff3cd);
        }

        .premio-card.plata {
            border-top-color: #c0c0c0;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        }

        .premio-card.bronce {
            border-top-color: #cd7f32;
            background: linear-gradient(135deg, #fef9e7, #fcf3cf);
        }

        .premio-emoji {
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 15px;
        }

        .premio-nombre {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary);
            text-align: center;
            margin-bottom: 10px;
        }

        .premio-descripcion {
            color: #7f8c8d;
            font-size: 0.9rem;
            text-align: center;
            margin-bottom: 15px;
        }

        .curso-premiado {
            background: #e8f6f3;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid var(--success);
        }

        .curso-premiado .nombre-curso {
            font-weight: bold;
            color: var(--primary);
        }

        .curso-premiado .puntos-curso {
            color: var(--success);
            font-weight: bold;
        }

        .sin-premios {
            text-align: center;
            padding: 30px;
            color: #7f8c8d;
            font-style: italic;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 20px 0;
        }

        .premio-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
    </style>
</head>
<body>
    <div id="pin-overlay" class="overlay">
        <div class="pin-container">
            <h2 style="color: var(--primary); margin-bottom: 10px;">üîí Acceso a Configuraci√≥n</h2>
            <p style="color: #7f8c8d; margin-bottom: 30px;">Ingrese el PIN de 4 d√≠gitos para acceder a la configuraci√≥n</p>
            
            <div class="pin-input-container">
                <input type="password" maxlength="1" class="pin-input" id="pin-digit-1" autocomplete="off">
                <input type="password" maxlength="1" class="pin-input" id="pin-digit-2" autocomplete="off">
                <input type="password" maxlength="1" class="pin-input" id="pin-digit-3" autocomplete="off">
                <input type="password" maxlength="1" class="pin-input" id="pin-digit-4" autocomplete="off">
            </div>
            
            <div class="pin-keypad">
                <button class="pin-key" data-key="1">1</button>
                <button class="pin-key" data-key="2">2</button>
                <button class="pin-key" data-key="3">3</button>
                <button class="pin-key" data-key="4">4</button>
                <button class="pin-key" data-key="5">5</button>
                <button class="pin-key" data-key="6">6</button>
                <button class="pin-key" data-key="7">7</button>
                <button class="pin-key" data-key="8">8</button>
                <button class="pin-key" data-key="9">9</button>
                <button class="pin-key clear">C</button>
                <button class="pin-key" data-key="0">0</button>
                <button class="pin-key enter">‚Ü©Ô∏è Entrar</button>
            </div>
            
            <div id="pin-error" style="color: var(--danger); margin-top: 20px; display: none;">
                ‚ùå PIN incorrecto. Intente nuevamente.
            </div>
            
            <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid #eee;">
                <p style="font-size: 0.9rem; color: #7f8c8d;">
                    <strong>PIN predeterminado:</strong> 1234<br>
                    Cambie el PIN en la secci√≥n de seguridad de configuraci√≥n
                </p>
            </div>
        </div>
    </div>

    <div class="container" id="main-container" style="display: none;">
        <header>
            <div class="header-logos">
                <div class="logo-left">
                    <img src="https://github.com/ccari-crypto/Juegos-de-Convivencia-escolar/blob/main/JDH.png?raw=true" alt="Logo Izquierdo">
                </div>
                <div class="logo-right">
                    <img src="https://github.com/ccari-crypto/Juegos-de-Convivencia-escolar/blob/main/Logo%20NSM.png?raw=true" alt="Logo Institucional">
                </div>
            </div>
            <h1 style="font-size: 2.5rem; margin-bottom: 10px;">üèÜ Juegos de Convivencia Escolar</h1>
            <p style="font-size: 1.2rem; opacity: 0.9;">Versi√≥n Final RTDB - Sincronizaci√≥n en tiempo real</p>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="registro">üìù Registro Individual</div>
            <div class="tab" data-tab="colectivo">üè´ Evaluaci√≥n Colectiva</div>
            <div class="tab" data-tab="ranking-cursos">üìà Ranking de Cursos</div>
            <div class="tab" data-tab="ranking">üìä Ranking y Mediadores</div>
            <div class="tab" data-tab="info">üìã Informaci√≥n</div>
            <div class="tab" id="config-tab" data-tab="config">‚öôÔ∏è Configuraci√≥n</div>
        </div>
        
        <div class="tab-content active" id="registro">
            <h2 style="color: var(--primary); margin-bottom: 25px; font-size: 1.8rem;">üìù Registro Individual de Conductas</h2>
            
            <div class="card">
                <h3 style="margin-bottom: 20px; color: var(--primary);">Registro R√°pido</h3>
                
                <div class="form-group">
                    <label>Curso:</label>
                    <select id="curso">
                        <option value="">Seleccionar curso</option>
                    </select>
                </div>
                
                <div class="form-group student-search-container">
                    <label>Estudiante:</label>
                    <div style="position: relative;">
                        <input type="text" id="student-search" placeholder="Escriba para buscar o seleccione de la lista">
                        <span class="search-icon">üîç</span>
                    </div>
                    <div class="student-list" id="student-list"></div>
                    <input type="hidden" id="estudiante-seleccionado">
                    <div id="selected-student" style="margin-top: 10px; padding: 10px; background: #e8f4fc; border-radius: 5px; display: none;">
                        <strong>Estudiante seleccionado:</strong> <span id="selected-student-name"></span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>C√≥digo de Conducta:</label>
                    <select id="codigo">
                        <option value="">Seleccionar c√≥digo</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Descripci√≥n breve (opcional):</label>
                    <textarea id="descripcion" placeholder="Ej: Ayud√≥ a organizar materiales despu√©s de clase" rows="2"></textarea>
                </div>
                
                <button id="btn-registrar">‚úÖ Guardar Registro</button>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 20px; color: var(--primary);">C√≥digos de Conducta</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;" id="codigos-container">
                    <!-- Los c√≥digos se cargar√°n aqu√≠ din√°micamente -->
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="colectivo">
            <h2 style="color: var(--primary); margin-bottom: 25px; font-size: 1.8rem;">üè´ Evaluaci√≥n Colectiva por Curso</h2>
            
            <div class="card">
                <h3 style="margin-bottom: 20px; color: var(--primary);">Evaluaci√≥n Semanal del Curso</h3>
                
                <div class="form-group">
                    <label>Curso a evaluar:</label>
                    <select id="curso-evaluacion">
                        <option value="">Seleccionar curso</option>
                    </select>
                </div>
                
                <div class="evaluation-container">
                    <div class="evaluation-dimension">
                        <h4>ü§ù Clima entre Compa√±eros</h4>
                        <p><small>Calidad de las relaciones entre estudiantes</small></p>
                        <div class="slider-container">
                            <input type="range" min="0" max="10" value="5" class="slider" id="clima">
                            <div class="slider-value" id="clima-value">5/10</div>
                        </div>
                    </div>
                    
                    <div class="evaluation-dimension">
                        <h4>üìö Comportamiento en Sala</h4>
                        <p><small>Actitud durante las clases</small></p>
                        <div class="slider-container">
                            <input type="range" min="0" max="10" value="5" class="slider" id="comportamiento">
                            <div class="slider-value" id="comportamiento-value">5/10</div>
                        </div>
                    </div>
                    
                    <div class="evaluation-dimension">
                        <h4>üßπ Aseo y Limpieza</h4>
                        <p><small>Orden y limpieza de la sala</small></p>
                        <div class="slider-container">
                            <input type="range" min="0" max="10" value="5" class="slider" id="aseo">
                            <div class="slider-value" id="aseo-value">5/10</div>
                        </div>
                    </div>
                    
                    <div class="evaluation-dimension">
                        <h4>üéØ Disciplina y Respeto</h4>
                        <p><small>Cumplimiento de normas y respeto</small></p>
                        <div class="slider-container">
                            <input type="range" min="0" max="10" value="5" class="slider" id="disciplina">
                            <div class="slider-value" id="disciplina-value">5/10</div>
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center; margin: 25px 0; padding: 20px; background: linear-gradient(135deg, #e8f6f3, #d1f2eb); border-radius: 10px;">
                    <h3 style="color: var(--primary); margin-bottom: 10px;">Puntos Totales de Evaluaci√≥n</h3>
                    <div style="font-size: 2.5rem; font-weight: bold; color: var(--success);" id="puntos-totales">0</div>
                    <p><small>(Cada punto √ó 2 = puntos para el curso)</small></p>
                    <p style="margin-top: 10px; font-size: 1.2rem; color: var(--primary);" id="puntos-curso">0 puntos para el curso</p>
                </div>
                
                <button id="btn-guardar-evaluacion" class="btn-secondary">üíæ Guardar Evaluaci√≥n Semanal</button>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 20px; color: var(--primary);">√öltimas Evaluaciones por Curso</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Curso</th>
                            <th>Semana</th>
                            <th>Clima</th>
                            <th>Comportamiento</th>
                            <th>Aseo</th>
                            <th>Disciplina</th>
                            <th>Total</th>
                            <th>Puntos</th>
                        </tr>
                    </thead>
                    <tbody id="historial-evaluaciones">
                        <tr><td colspan="8">No hay evaluaciones registradas</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="tab-content" id="ranking-cursos">
            <h2 style="color: var(--primary); margin-bottom: 25px; font-size: 1.8rem;">üìà Ranking de Cursos - Puntos Totales</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="total-cursos-ranking">0</div>
                    <div class="stat-label">Cursos Totales</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="puntos-totales-ranking">0</div>
                    <div class="stat-label">Puntos Totales</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="curso-lider">-</div>
                    <div class="stat-label">Curso L√≠der</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="diferencia-min">0</div>
                    <div class="stat-label">Diferencia M√≠nima</div>
                </div>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 20px; color: var(--primary);">üèÜ Tabla de Posiciones por Curso</h3>
                
                <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                    <h4 style="color: var(--secondary); margin-bottom: 10px;">üìä Desglose de Puntos</h4>
                    <p>Los puntos totales se calculan como: <strong>Puntos Colectivos + Bonus Mediadores</strong></p>
                    <p><small style="color: var(--warning);">NOTA: Los puntos individuales ya NO intervienen en los puntos del curso</small></p>
                </div>
                
                <table id="tabla-ranking-cursos">
                    <thead>
                        <tr>
                            <th>Posici√≥n</th>
                            <th>Curso</th>
                            <th>Puntos Totales</th>
                            <th>Puntos Colectivos</th>
                            <th>Bonus Mediadores</th>
                            <th>Mediadores</th>
                        </tr>
                    </thead>
                    <tbody id="cuerpo-tabla-ranking">
                        <tr><td colspan="6">Cargando datos de cursos...</td></tr>
                    </tbody>
                </table>
                
                <div style="margin-top: 25px; padding: 15px; background: linear-gradient(135deg, #e8f6f3, #d1f2eb); border-radius: 10px;">
                    <h4 style="color: var(--success); margin-bottom: 10px;">üèÖ Medallas de Posici√≥n</h4>
                    <div style="display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; gap: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 2.5rem;">ü•á</div>
                            <div><strong>1er Lugar</strong></div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2.5rem;">ü•à</div>
                            <div><strong>2do Lugar</strong></div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2.5rem;">ü•â</div>
                            <div><strong>3er Lugar</strong></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- NUEVA SECCI√ìN: CURSOS GANADORES DE PREMIOS -->
            <div class="card">
                <h3 style="margin-bottom: 20px; color: var(--primary);">üèÖ Cursos Ganadores de Premios</h3>
                
                <div style="margin-bottom: 20px; padding: 15px; background: #e8f6f3; border-radius: 10px;">
                    <h4 style="color: var(--success); margin-bottom: 10px;">üìã Premios Colectivos Disponibles</h4>
                    <p>Los cursos reciben premios cuando alcanzan ciertos niveles de puntos totales. Los premios se otorgan bimestralmente.</p>
                </div>
                
                <div id="cursos-premiados-container" class="premios-container">
                    <!-- Los cursos premiados se cargar√°n aqu√≠ din√°micamente -->
                </div>
                
                <div id="sin-premios-msg" class="sin-premios" style="display: none;">
                    <p>üì≠ A√∫n no hay cursos que hayan alcanzado los niveles de puntos necesarios para premios.</p>
                    <p><small>¬°Sigan acumulando puntos colectivos y formando mediadores!</small></p>
                </div>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 20px; color: var(--primary);">üìà Evoluci√≥n Semanal por Curso</h3>
                <div style="padding: 20px; background: #f8f9fa; border-radius: 10px; min-height: 300px;" id="grafico-evolucion">
                    <p style="text-align: center; color: #7f8c8d; padding: 50px 0;">Gr√°fico de evoluci√≥n de puntos por curso</p>
                    <div class="grafico-barras-container" style="display: flex; justify-content: space-around; align-items: flex-end; height: 200px; margin-top: 30px; padding: 0 20px;"></div>
                </div>
                <button id="btn-actualizar-ranking" class="btn-secondary" style="margin-top: 15px;">üîÑ Actualizar Ranking</button>
            </div>
        </div>
        
        <div class="tab-content" id="ranking">
            <h2 style="color: var(--primary); margin-bottom: 25px; font-size: 1.8rem;">üìä Ranking y Sistema de Mediadores</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="total-cursos">0</div>
                    <div class="stat-label">Cursos Activos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-mediadores">0</div>
                    <div class="stat-label">Mediadores Totales</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-puntos">0</div>
                    <div class="stat-label">Puntos Totales</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="semana-actual">1</div>
                    <div class="stat-label">Semana Actual</div>
                </div>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 20px; color: var(--primary);">üèÜ Ranking de Cursos</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Posici√≥n</th>
                            <th>Curso</th>
                            <th>Puntos Colectivos</th>
                            <th>Bonus Mediadores</th>
                            <th>Puntos Totales</th>
                            <th>Mediadores</th>
                        </tr>
                    </thead>
                    <tbody id="tabla-ranking">
                        <tr><td colspan="6">Cargando datos...</td></tr>
                    </tbody>
                </table>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 20px; color: var(--primary);">üë• Sistema de Mediadores Gamificado</h3>
                
                <div class="mediator-levels" id="mediator-levels-container">
                    <!-- Los niveles se cargar√°n aqu√≠ din√°micamente -->
                </div>
                
                <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 4px solid var(--warning);">
                    <p><strong>üìù Notas importantes:</strong></p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Los estudiantes suben/bajan de nivel autom√°ticamente seg√∫n sus puntos individuales</li>
                        <li>M√°ximo 3 mediadores por nivel por curso</li>
                        <li>El bonus del curso es la suma de todos sus mediadores</li>
                        <li>Los mediadores pueden perder el nivel si sus puntos individuales bajan</li>
                        <li>Los puntos individuales NO afectan los puntos colectivos del curso</li>
                    </ul>
                </div>
                
                <h4 style="margin: 25px 0 15px 0; color: var(--primary);">Lista de Mediadores por Curso</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Curso</th>
                            <th>Estudiante</th>
                            <th>Nivel</th>
                            <th>Puntos Individuales</th>
                            <th>Bonus</th>
                        </tr>
                    </thead>
                    <tbody id="tabla-mediadores">
                        <tr><td colspan="5">No hay mediadores registrados</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="tab-content" id="info">
            <h2 style="color: var(--primary); margin-bottom: 25px; font-size: 1.8rem;">üìã Informaci√≥n del Sistema</h2>
            
            <div class="card">
                <h3 style="margin-bottom: 15px; color: var(--primary);">üéØ Sistema Completo de Puntos</h3>
                
                <h4 style="color: var(--success); margin-top: 20px;">Puntos Individuales:</h4>
                <p><em>Solo para determinar nivel de mediadores y premios individuales</em></p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0;" id="puntos-individuales-container">
                    <!-- Los puntos individuales se cargar√°n aqu√≠ -->
                </div>
                
                <div style="background: #e8f4fc; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid var(--secondary);">
                    <p><strong>‚ö†Ô∏è IMPORTANTE:</strong> Los puntos individuales ya NO suman al curso. Solo afectan:</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Nivel de mediador del estudiante</li>
                        <li>Premios individuales mensuales</li>
                        <li>Determinaci√≥n del bonus semanal que otorga al curso</li>
                    </ul>
                </div>
                
                <h4 style="color: var(--secondary); margin-top: 25px;">Puntos Colectivos (Curso):</h4>
                <p>Evaluaci√≥n semanal del profesor jefe en 4 dimensiones:</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0;" id="puntos-colectivos-container">
                    <!-- Los puntos colectivos se cargar√°n aqu√≠ -->
                </div>
                
                <h4 style="color: var(--warning); margin-top: 25px;">Bonus por Mediadores:</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0;" id="bonus-mediadores-container">
                    <!-- Los bonus se cargar√°n aqu√≠ -->
                </div>
                
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px; border: 2px solid var(--success);">
                    <h4 style="color: var(--success); margin-bottom: 10px;">üìä F√≥rmula Final de Puntos del Curso:</h4>
                    <p style="font-size: 1.2rem; text-align: center; font-weight: bold;">
                        Puntos Totales = Puntos Colectivos + Bonus Mediadores
                    </p>
                    <p style="text-align: center; color: #7f8c8d;">
                        (Puntos individuales ya no intervienen en los puntos del curso)
                    </p>
                </div>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 15px; color: var(--primary);">üèÜ Sistema de Premios</h3>
                
                <h4>Premios Individuales (Mensuales):</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin: 15px 0;" id="premios-individuales-container">
                    <!-- Los premios individuales se cargar√°n aqu√≠ -->
                </div>
                
                <h4 style="margin-top: 25px;">Premios Colectivos (Bimestrales):</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0;" id="premios-colectivos-container">
                    <!-- Los premios colectivos se cargar√°n aqu√≠ -->
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="config">
            <h2 style="color: var(--primary); margin-bottom: 25px; font-size: 1.8rem;">‚öôÔ∏è Configuraci√≥n del Sistema</h2>
            
            <div class="card">
                <h3 style="margin-bottom: 20px; color: var(--primary);">üîí Seguridad y Acceso</h3>
                
                <div class="form-group">
                    <h4 style="margin-bottom: 15px; color: var(--secondary);">Cambiar PIN de Acceso</h4>
                    <p style="margin-bottom: 15px; color: #7f8c8d;">El PIN debe tener 4 d√≠gitos. Se utiliza para acceder a esta secci√≥n de configuraci√≥n.</p>
                    
                    <div class="input-group">
                        <input type="password" id="nuevo-pin-1" placeholder="Nuevo PIN (4 d√≠gitos)" maxlength="4" pattern="\d{4}">
                        <input type="password" id="nuevo-pin-2" placeholder="Confirmar PIN" maxlength="4" pattern="\d{4}">
                        <button id="btn-cambiar-pin" class="btn-small">üîê Cambiar PIN</button>
                    </div>
                    
                    <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <p><strong>Estado actual:</strong> <span id="pin-status">Cargando...</span></p>
                        <p><small>El PIN predeterminado es <strong>1234</strong></small></p>
                    </div>
                </div>
                
                <div class="form-group">
                    <h4 style="margin-bottom: 15px; color: var(--secondary);">Sesi√≥n Actual</h4>
                    <div style="padding: 15px; background: #e8f6f3; border-radius: 8px;">
                        <p><strong>üîì Sesi√≥n activa:</strong> Acceso a configuraci√≥n habilitado</p>
                        <p><small>Sesi√≥n iniciada: <span id="sesion-iniciada"></span></small></p>
                        <button id="btn-cerrar-sesion" class="btn-small btn-warning" style="margin-top: 10px;">üö™ Cerrar Sesi√≥n de Configuraci√≥n</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <h4 style="margin-bottom: 15px; color: var(--secondary);">üî• Configuraci√≥n Firebase RTDB</h4>
                    <div style="padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid var(--warning);">
                        <p><strong>Estado Firebase:</strong> <span id="firebase-config-status">Verificando...</span></p>
                        <p><small>ID de Escuela: <strong id="school-id-display">escuela_default</strong></small></p>
                        <div style="margin-top: 10px;">
                            <button id="btn-sincronizar-ahora" class="btn-small">üîÑ Sincronizar Ahora</button>
                            <button id="btn-forzar-subida" class="btn-small btn-secondary">üì§ Forzar Subida</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="config-tabs">
                <div class="config-tab active" data-config-tab="cursos">üìö Cursos</div>
                <div class="config-tab" data-config-tab="estudiantes">üë• Estudiantes</div>
                <div class="config-tab" data-config-tab="puntos">üéØ Puntos y C√≥digos</div>
                <div class="config-tab" data-config-tab="mediadores">üèÜ Mediadores</div>
                <div class="config-tab" data-config-tab="premios">üèÖ Premios</div>
                <div class="config-tab" data-config-tab="backup">üíæ Backup</div>
            </div>
            
            <div class="config-tab-content active" id="config-cursos">
                <div class="card">
                    <h3 style="margin-bottom: 20px; color: var(--primary);">üìö Gesti√≥n de Cursos</h3>
                    
                    <div class="form-group">
                        <h4 style="margin-bottom: 15px; color: var(--secondary);">Agregar Nuevo Curso</h4>
                        <div class="input-group">
                            <input type="text" id="nuevo-curso-codigo" placeholder="C√≥digo (ej: 8A)" maxlength="10">
                            <input type="text" id="nuevo-curso-nombre" placeholder="Nombre completo (ej: 8¬∞A B√°sico)">
                            <button id="btn-agregar-curso" class="btn-small">‚ûï Agregar</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <h4 style="margin-bottom: 15px; color: var(--secondary);">Cursos Existentes</h4>
                        <table class="editable-table">
                            <thead>
                                <tr>
                                    <th>C√≥digo</th>
                                    <th>Nombre</th>
                                    <th>Estudiantes</th>
                                    <th>Puntos Colectivos</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="tabla-cursos"></tbody>
                        </table>
                    </div>
                    
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 20px;">
                        <p><strong>‚ö†Ô∏è Nota:</strong> Al eliminar un curso, tambi√©n se eliminar√°n todos sus estudiantes y registros asociados.</p>
                    </div>
                </div>
            </div>
            
            <div class="config-tab-content" id="config-estudiantes">
                <div class="card">
                    <h3 style="margin-bottom: 20px; color: var(--primary);">üë• Gesti√≥n de Estudiantes</h3>
                    
                    <div class="form-group">
                        <h4 style="margin-bottom: 15px; color: var(--secondary);">Agregar Estudiante Individual</h4>
                        <div class="input-group">
                            <select id="curso-estudiante">
                                <option value="">Seleccionar curso</option>
                            </select>
                            <input type="text" id="nuevo-estudiante-nombre" placeholder="Nombre completo del estudiante">
                            <button id="btn-agregar-estudiante" class="btn-small">‚ûï Agregar</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <h4 style="margin-bottom: 15px; color: var(--secondary);">Carga Masiva de Estudiantes</h4>
                        <p><small>Ingrese uno por l√≠nea: <strong>c√≥digo_curso|nombre_estudiante</strong> (ej: 5A|Ana Mart√≠nez)</small></p>
                        <textarea id="estudiantes-masivos" rows="6" placeholder="5A|Ana Mart√≠nez L√≥pez
5A|Carlos Gonz√°lez Silva
5B|Javier Morales Herrera"></textarea>
                        <div class="action-buttons">
                            <button id="btn-cargar-estudiantes" class="btn-secondary">üì• Cargar Estudiantes</button>
                            <button id="btn-descargar-ejemplo" class="btn-small">üìã Descargar Ejemplo</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <h4 style="margin-bottom: 15px; color: var(--secondary);">Estudiantes por Curso</h4>
                        <select id="filtro-curso-estudiantes">
                            <option value="">Todos los cursos</option>
                        </select>
                        <table class="editable-table" style="margin-top: 15px;">
                            <thead>
                                <tr>
                                    <th>Curso</th>
                                    <th>Estudiante</th>
                                    <th>Puntos Individuales</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="tabla-estudiantes"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="config-tab-content" id="config-puntos">
                <div class="card">
                    <h3 style="margin-bottom: 20px; color: var(--primary);">üéØ Configuraci√≥n de Puntos y C√≥digos</h3>
                    
                    <div class="form-group">
                        <h4 style="margin-bottom: 15px; color: var(--secondary);">C√≥digos de Conducta</h4>
                        <table class="editable-table">
                            <thead>
                                <tr>
                                    <th>C√≥digo</th>
                                    <th>Nombre</th>
                                    <th>Tipo</th>
                                    <th>Puntos Individuales</th>
                                    <th>Descripci√≥n</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="tabla-codigos"></tbody>
                        </table>
                        <button id="btn-agregar-codigo" class="btn-small" style="margin-top: 10px;">‚ûï Agregar C√≥digo</button>
                    </div>
                    
                    <div class="form-group">
                        <h4 style="margin-bottom: 15px; color: var(--secondary);">Configuraci√≥n de Puntos</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                            <div style="padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                <label>Multiplicador Evaluaci√≥n Colectiva:</label>
                                <input type="number" id="mult-evaluacion" min="1" max="10" step="0.5" style="width: 100px;">
                                <small>Actual: √ó2 puntos por evaluaci√≥n</small>
                            </div>
                            <div style="padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                <label>M√°ximo Mediadores por Nivel:</label>
                                <input type="number" id="max-mediadores-nivel" min="1" max="10" style="width: 100px;">
                                <small>Actual: 3 por nivel</small>
                            </div>
                        </div>
                        <button id="btn-guardar-config-puntos" class="btn-small" style="margin-top: 15px;">üíæ Guardar Configuraci√≥n</button>
                    </div>
                </div>
            </div>
            
            <div class="config-tab-content" id="config-mediadores">
                <div class="card">
                    <h3 style="margin-bottom: 20px; color: var(--primary);">üèÜ Configuraci√≥n de Mediadores</h3>
                    
                    <div class="form-group">
                        <h4 style="margin-bottom: 15px; color: var(--secondary);">Niveles de Mediadores</h4>
                        <table class="editable-table">
                            <thead>
                                <tr>
                                    <th>Nivel</th>
                                    <th>Nombre</th>
                                    <th>Puntos M√≠nimos Individuales</th>
                                    <th>Bonus Semanal al Curso</th>
                                    <th>Descripci√≥n</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="tabla-niveles"></tbody>
                        </table>
                    </div>
                    
                    <div style="background: #e8f4fc; padding: 15px; border-radius: 8px; margin-top: 20px;">
                        <p><strong>üí° Nota:</strong> Los cambios en los niveles afectar√°n autom√°ticamente a los mediadores existentes.</p>
                        <p><small>Los puntos individuales determinan el nivel del mediador, y este nivel determina el bonus semanal al curso.</small></p>
                    </div>
                </div>
            </div>
            
            <div class="config-tab-content" id="config-premios">
                <div class="card">
                    <h3 style="margin-bottom: 20px; color: var(--primary);">üèÖ Configuraci√≥n de Premios</h3>
                    
                    <div class="form-group">
                        <h4 style="margin-bottom: 15px; color: var(--secondary);">Premios Individuales (Mensuales)</h4>
                        <table class="editable-table">
                            <thead>
                                <tr>
                                    <th>Medalla</th>
                                    <th>Nombre</th>
                                    <th>Puntos Individuales M√≠nimos</th>
                                    <th>Descripci√≥n</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="tabla-premios-individuales"></tbody>
                        </table>
                        <button id="btn-agregar-premio-individual" class="btn-small" style="margin-top: 10px;">‚ûï Agregar Premio</button>
                    </div>
                    
                    <div class="form-group">
                        <h4 style="margin-bottom: 15px; color: var(--secondary);">Premios Colectivos (Bimestrales)</h4>
                        <table class="editable-table">
                            <thead>
                                <tr>
                                    <th>Puntos del Curso Requeridos</th>
                                    <th>Premio</th>
                                    <th>Descripci√≥n</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="tabla-premios-colectivos"></tbody>
                        </table>
                        <button id="btn-agregar-premio-colectivo" class="btn-small" style="margin-top: 10px;">‚ûï Agregar Premio</button>
                    </div>
                </div>
            </div>
            
            <div class="config-tab-content" id="config-backup">
                <div class="card">
                    <h3 style="margin-bottom: 20px; color: var(--primary);">üíæ Backup y Restauraci√≥n</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="padding: 20px; background: #e8f6f3; border-radius: 10px; text-align: center;">
                            <h4 style="color: var(--success); margin-bottom: 15px;">üì• Exportar Datos</h4>
                            <p>Descarga todos los datos del sistema en un archivo JSON.</p>
                            <button id="btn-exportar-datos" class="btn-secondary" style="margin-top: 10px;">üíæ Exportar JSON</button>
                        </div>
                        
                        <div style="padding: 20px; background: #fef9e7; border-radius: 10px; text-align: center;">
                            <h4 style="color: var(--warning); margin-bottom: 15px;">üì§ Importar Datos</h4>
                            <p>Importa datos desde un archivo JSON.</p>
                            <input type="file" id="import-file" accept=".json" style="margin: 15px 0; width: 100%;">
                            <button id="btn-importar-datos" class="btn-warning">üì§ Importar JSON</button>
                        </div>
                        
                        <div style="padding: 20px; background: #fdebd0; border-radius: 10px; text-align: center;">
                            <h4 style="color: var(--danger); margin-bottom: 15px;">üîÑ Restablecer</h4>
                            <p>Restablece todos los datos a los valores predeterminados.</p>
                            <button id="btn-restablecer-datos" class="btn-danger">üîÑ Restablecer Sistema</button>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                        <h4 style="color: var(--primary); margin-bottom: 15px;">üìä Estad√≠sticas del Sistema</h4>
                        <div id="estadisticas-sistema"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="notification-area"></div>

    <div id="modal-confirmacion" class="modal-overlay" style="display: none;">
        <div class="modal">
            <h3 id="modal-titulo" style="color: var(--primary); margin-bottom: 15px;"></h3>
            <p id="modal-mensaje"></p>
            <div class="modal-buttons">
                <button id="modal-cancelar" class="btn-secondary">Cancelar</button>
                <button id="modal-confirmar" class="btn-danger">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Sello de agua -->
    <div class="watermark" id="watermark">
        Aplicaci√≥n desarrollada por Cristian Cari Enero 2026
    </div>

    <script>
        // ============================================
        // CONFIGURACI√ìN FIREBASE (SIMPLIFICADA PARA PRUEBAS)
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyD1G0UGc2iHVH-db7HNLI8T9u7Y1aqSD44",
            authDomain: "juego-convivencia-escolar.firebaseapp.com",
            databaseURL: "https://juego-convivencia-escolar-default-rtdb.firebaseio.com",
            projectId: "juego-convivencia-escolar",
            storageBucket: "juego-convivencia-escolar.firebasestorage.app",
            messagingSenderId: "764735739764",
            appId: "1:764735739764:web:df8fa79a0f9f2978883e21"
        };

        const SCHOOL_ID = "escuela_default";

        let database;
        let firebaseInitialized = false;
        let isOnline = false;
        let syncInProgress = false;

        // ============================================
        // CONFIGURACI√ìN DEL SISTEMA
        // ============================================
        let autenticado = false;
        let sesionIniciada = null;
        const PIN_PREDETERMINADO = '1234';

        let sistema = {
            semanaActual: 1,
            seguridad: {
                pin: PIN_PREDETERMINADO,
                pinConfigurado: false
            },
            configuracion: {
                puntosCodigos: {
                    'AA': { nombre: 'Ayuda a otro', puntos: 5, tipo: 'positiva', descripcion: 'Ayuda espont√°nea a compa√±ero' },
                    'RE': { nombre: 'Resoluci√≥n pac√≠fica', puntos: 10, tipo: 'positiva', descripcion: 'Media o resuelve conflicto' },
                    'LP': { nombre: 'Liderazgo positivo', puntos: 8, tipo: 'positiva', descripcion: 'Organiza actividades constructivas' },
                    'IR': { nombre: 'Intervenci√≥n responsable', puntos: 15, tipo: 'positiva', descripcion: 'Reporta o interviene en bullying' },
                    'CC': { nombre: 'Conflicto compa√±ero', puntos: -5, tipo: 'negativa', descripcion: 'Inicia conflicto con compa√±ero' },
                    'FD': { nombre: 'Falta de respeto', puntos: -8, tipo: 'negativa', descripcion: 'Falta de respeto a profesor/compa√±ero' }
                },
                nivelesMediadores: [
                    { nivel: 1, nombre: 'Aprendiz de la Convivencia', puntosMin: 100, bonus: 10, descripcion: 'En etapa de aprendizaje y observaci√≥n' },
                    { nivel: 2, nombre: 'Mediador Novato', puntosMin: 200, bonus: 20, descripcion: 'Ya puede mediar en conflictos menores' },
                    { nivel: 3, nombre: 'Guardi√°n de la Convivencia', puntosMin: 300, bonus: 30, descripcion: 'Experto, puede entrenar a otros mediadores' }
                ],
                premiosIndividuales: [
                    { medalla: 'ü•â', nombre: 'Bronce', puntosMin: 30, descripcion: 'Certificado + Stickers' },
                    { medalla: 'ü•à', nombre: 'Plata', puntosMin: 50, descripcion: 'Hora libre + Menci√≥n' },
                    { medalla: 'ü•á', nombre: 'Oro', puntosMin: 80, descripcion: 'Foto en Muro del Respeto' }
                ],
                premiosColectivos: [
                    { puntos: 300, premio: 'üëï D√≠a sin uniforme', descripcion: 'Un d√≠a sin uniforme para el curso' },
                    { puntos: 500, premio: '‚è∞ Recreo extendido', descripcion: 'Recreo extendido 15 minutos' },
                    { puntos: 700, premio: 'üéâ Actividad especial', descripcion: 'Actividad especial organizada' }
                ],
                multiplicadorEvaluacion: 2,
                maxMediadoresPorNivel: 3
            },
            cursos: {
                '5A': { nombre: '5¬∞A B√°sico', puntosColectivos: 0, evaluaciones: [] },
                '5B': { nombre: '5¬∞B B√°sico', puntosColectivos: 0, evaluaciones: [] },
                '6A': { nombre: '6¬∞A B√°sico', puntosColectivos: 0, evaluaciones: [] },
                '6B': { nombre: '6¬∞B B√°sico', puntosColectivos: 0, evaluaciones: [] },
                '7A': { nombre: '7¬∞A B√°sico', puntosColectivos: 0, evaluaciones: [] },
                '7B': { nombre: '7¬∞B B√°sico', puntosColectivos: 0, evaluaciones: [] }
            },
            estudiantes: {
                '5A': [
                    { id: '5A-1', nombre: 'Ana Mart√≠nez L√≥pez', puntos: 45 },
                    { id: '5A-2', nombre: 'Carlos Gonz√°lez Silva', puntos: 32 },
                    { id: '5A-3', nombre: 'Sof√≠a P√©rez Rojas', puntos: 67 },
                    { id: '5A-4', nombre: 'Diego Ram√≠rez Torres', puntos: 28 }
                ],
                '5B': [
                    { id: '5B-1', nombre: 'Javier Morales Herrera', puntos: 38 },
                    { id: '5B-2', nombre: 'Camila Soto Vargas', puntos: 71 },
                    { id: '5B-3', nombre: 'Mat√≠as Flores Mu√±oz', puntos: 29 },
                    { id: '5B-4', nombre: 'Isabel Rojas Paredes', puntos: 62 }
                ],
                '6A': [
                    { id: '6A-1', nombre: 'Martina Silva G√≥mez', puntos: 88 },
                    { id: '6A-2', nombre: 'Tom√°s Fern√°ndez Castro', puntos: 105 },
                    { id: '6A-3', nombre: 'Emilia Vargas Ruiz', puntos: 92 },
                    { id: '6A-4', nombre: 'Maximiliano Soto L√≥pez', puntos: 76 }
                ],
                '6B': [
                    { id: '6B-1', nombre: 'Sebasti√°n Vega Torres', puntos: 58 },
                    { id: '6B-2', nombre: 'Florencia Castillo Reyes', puntos: 47 },
                    { id: '6B-3', nombre: 'Lucas Reyes Mendoza', puntos: 81 },
                    { id: '6B-4', nombre: 'Renata Mendoza Pe√±a', puntos: 36 }
                ],
                '7A': [
                    { id: '7A-1', nombre: 'Agust√≠n Guzm√°n Ruiz', puntos: 124 },
                    { id: '7A-2', nombre: 'Constanza Ruiz Medina', puntos: 97 },
                    { id: '7A-3', nombre: 'Joaqu√≠n L√≥pez Castro', puntos: 132 },
                    { id: '7A-4', nombre: 'Francisca Medina Flores', puntos: 85 }
                ],
                '7B': [
                    { id: '7B-1', nombre: 'Mariana Ortega Paredes', puntos: 91 },
                    { id: '7B-2', nombre: 'Samuel Paredes Figueroa', puntos: 67 },
                    { id: '7B-3', nombre: 'Amanda Castro R√≠os', puntos: 119 },
                    { id: '7B-4', nombre: '√Ålvaro Figueroa Salazar', puntos: 78 }
                ]
            },
            registros: [],
            mediadores: []
        };

        // ============================================
        // FUNCIONES DE UTILIDAD
        // ============================================
        function mostrarNotificacion(mensaje, tipo = 'success') {
            const area = document.getElementById('notification-area');
            const notificacion = document.createElement('div');
            notificacion.className = `notification ${tipo}`;
            notificacion.textContent = mensaje;
            area.appendChild(notificacion);
            
            setTimeout(() => {
                notificacion.style.animation = 'slideIn 0.3s reverse';
                setTimeout(() => notificacion.remove(), 300);
            }, 3000);
        }

        function cargarDatos() {
            const datosGuardados = localStorage.getItem('sistemaConvivenciaFinal');
            if (datosGuardados) {
                try {
                    const datos = JSON.parse(datosGuardados);
                    
                    // Mezclar datos cargados con valores predeterminados
                    if (datos.seguridad) sistema.seguridad = datos.seguridad;
                    if (datos.configuracion) sistema.configuracion = datos.configuracion;
                    if (datos.cursos) sistema.cursos = datos.cursos;
                    if (datos.estudiantes) sistema.estudiantes = datos.estudiantes;
                    if (datos.registros) sistema.registros = datos.registros;
                    if (datos.semanaActual) sistema.semanaActual = datos.semanaActual;
                    
                    console.log("üìÇ Datos cargados de localStorage");
                } catch (error) {
                    console.error("Error al cargar datos:", error);
                    mostrarNotificacion("Error al cargar datos guardados", "error");
                }
            }
            
            actualizarInterfazCompleta();
        }

        function guardarDatos() {
            try {
                localStorage.setItem('sistemaConvivenciaFinal', JSON.stringify(sistema));
            } catch (error) {
                console.error("Error al guardar datos:", error);
                mostrarNotificacion("Error al guardar datos", "error");
            }
        }

        // ============================================
        // AUTENTICACI√ìN CON PIN (SIMPLIFICADA)
        // ============================================
        function inicializarSistemaPIN() {
            const pinOverlay = document.getElementById('pin-overlay');
            const mainContainer = document.getElementById('main-container');
            const configTab = document.getElementById('config-tab');
            
            // Verificar si hay sesi√≥n activa
            const sesionGuardada = sessionStorage.getItem('sesionConfiguracion');
            if (sesionGuardada) {
                try {
                    const sesionData = JSON.parse(sesionGuardada);
                    const tiempoTranscurrido = Date.now() - sesionData.timestamp;
                    const maxTiempoSesion = 2 * 60 * 60 * 1000; // 2 horas
                    
                    if (tiempoTranscurrido < maxTiempoSesion) {
                        autenticado = true;
                        sesionIniciada = new Date(sesionData.timestamp);
                        pinOverlay.classList.add('hidden');
                        mainContainer.style.display = 'block';
                        configTab.classList.remove('disabled');
                        actualizarEstadoSesion();
                        return;
                    } else {
                        sessionStorage.removeItem('sesionConfiguracion');
                    }
                } catch (error) {
                    console.error("Error al cargar sesi√≥n:", error);
                }
            }
            
            // Si no hay sesi√≥n activa, mostrar PIN
            pinOverlay.classList.remove('hidden');
            mainContainer.style.display = 'none';
            configTab.classList.add('disabled');
            
            // Configurar eventos del PIN
            const pinInputs = document.querySelectorAll('.pin-input');
            pinInputs.forEach((input, index) => {
                input.value = '';
                input.classList.remove('filled', 'error');
                
                input.addEventListener('input', function(e) {
                    if (this.value.length === 1 && index < 3) {
                        pinInputs[index + 1].focus();
                    }
                    this.classList.add('filled');
                    this.classList.remove('error');
                    document.getElementById('pin-error').style.display = 'none';
                });
            });
            
            // Enfocar el primer input
            pinInputs[0].focus();
            
            // Configurar teclado virtual
            document.querySelectorAll('.pin-key[data-key]').forEach(button => {
                button.addEventListener('click', function() {
                    const key = this.getAttribute('data-key');
                    
                    // Encontrar el primer input vac√≠o
                    for (let i = 0; i < pinInputs.length; i++) {
                        if (!pinInputs[i].value) {
                            pinInputs[i].value = key;
                            pinInputs[i].classList.add('filled');
                            pinInputs[i].classList.remove('error');
                            
                            if (i < 3) {
                                pinInputs[i + 1].focus();
                            }
                            break;
                        }
                    }
                    
                    document.getElementById('pin-error').style.display = 'none';
                });
            });
            
            // Bot√≥n limpiar
            document.querySelector('.pin-key.clear').addEventListener('click', function() {
                pinInputs.forEach(input => {
                    input.value = '';
                    input.classList.remove('filled', 'error');
                });
                pinInputs[0].focus();
                document.getElementById('pin-error').style.display = 'none';
            });
            
            // Bot√≥n entrar
            document.querySelector('.pin-key.enter').addEventListener('click', verificarPIN);
        }

        function verificarPIN() {
            const pinInputs = document.querySelectorAll('.pin-input');
            const pinIngresado = Array.from(pinInputs).map(input => input.value).join('');
            
            if (pinIngresado.length !== 4) {
                mostrarErrorPIN('Ingrese los 4 d√≠gitos del PIN');
                return;
            }
            
            if (pinIngresado === sistema.seguridad.pin) {
                autenticado = true;
                sesionIniciada = new Date();
                
                sessionStorage.setItem('sesionConfiguracion', JSON.stringify({
                    timestamp: sesionIniciada.getTime()
                }));
                
                document.getElementById('pin-overlay').classList.add('hidden');
                document.getElementById('main-container').style.display = 'block';
                document.getElementById('config-tab').classList.remove('disabled');
                
                actualizarEstadoSesion();
                mostrarNotificacion('‚úÖ Acceso a configuraci√≥n habilitado', 'success');
            } else {
                mostrarErrorPIN('PIN incorrecto. Intente nuevamente.');
            }
        }

        function mostrarErrorPIN(mensaje) {
            const pinInputs = document.querySelectorAll('.pin-input');
            pinInputs.forEach(input => {
                input.classList.add('error');
            });
            
            const errorDiv = document.getElementById('pin-error');
            errorDiv.textContent = `‚ùå ${mensaje}`;
            errorDiv.style.display = 'block';
            
            setTimeout(() => {
                pinInputs.forEach(input => {
                    input.value = '';
                    input.classList.remove('filled', 'error');
                });
                pinInputs[0].focus();
                errorDiv.style.display = 'none';
            }, 2000);
        }

        function actualizarEstadoSesion() {
            if (sesionIniciada) {
                const fecha = sesionIniciada.toLocaleTimeString();
                document.getElementById('sesion-iniciada').textContent = fecha;
            }
            
            const pinStatus = document.getElementById('pin-status');
            if (sistema.seguridad.pin === PIN_PREDETERMINADO && !sistema.seguridad.pinConfigurado) {
                pinStatus.innerHTML = '<span style="color: var(--warning);">‚ö†Ô∏è PIN predeterminado (1234) - Se recomienda cambiarlo</span>';
            } else {
                pinStatus.innerHTML = '<span style="color: var(--success);">‚úÖ PIN personalizado configurado</span>';
            }
        }

        // ============================================
        // GESTI√ìN DE TABS
        // ============================================
        function inicializarTabs() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    if (this.classList.contains('disabled')) {
                        if (this.getAttribute('data-tab') === 'config') {
                            if (!autenticado) {
                                mostrarNotificacion('Debe ingresar el PIN para acceder a la configuraci√≥n', 'warning');
                                document.getElementById('pin-overlay').classList.remove('hidden');
                            }
                        }
                        return;
                    }
                    
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    const tabContent = document.getElementById(tabId);
                    if (tabContent) {
                        tabContent.classList.add('active');
                    }
                    
                    if (tabId === 'config') {
                        if (!autenticado) {
                            document.querySelector('.tab[data-tab="registro"]').click();
                            return;
                        }
                        actualizarConfiguracionCompleta();
                    } else if (tabId === 'ranking-cursos') {
                        actualizarRankingCursos();
                    }
                });
            });

            document.querySelectorAll('.config-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.config-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.config-tab-content').forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-config-tab');
                    const tabContent = document.getElementById(`config-${tabId}`);
                    if (tabContent) {
                        tabContent.classList.add('active');
                    }
                });
            });
        }

        // ============================================
        // MODAL DE CONFIRMACI√ìN
        // ============================================
        let confirmacionCallback = null;

        function inicializarModal() {
            const modalCancelar = document.getElementById('modal-cancelar');
            const modalConfirmar = document.getElementById('modal-confirmar');
            
            if (modalCancelar) {
                modalCancelar.addEventListener('click', function() {
                    document.getElementById('modal-confirmacion').style.display = 'none';
                    confirmacionCallback = null;
                });
            }
            
            if (modalConfirmar) {
                modalConfirmar.addEventListener('click', function() {
                    if (confirmacionCallback) {
                        confirmacionCallback();
                    }
                    document.getElementById('modal-confirmacion').style.display = 'none';
                    confirmacionCallback = null;
                });
            }
        }

        function mostrarConfirmacion(titulo, mensaje, callback) {
            document.getElementById('modal-titulo').textContent = titulo;
            document.getElementById('modal-mensaje').textContent = mensaje;
            document.getElementById('modal-confirmacion').style.display = 'flex';
            confirmacionCallback = callback;
        }

        // ============================================
        // GESTI√ìN DE CURSOS
        // ============================================
        function actualizarListaCursos() {
            // Actualizar selects
            const selects = [
                document.getElementById('curso'),
                document.getElementById('curso-evaluacion'),
                document.getElementById('curso-estudiante'),
                document.getElementById('filtro-curso-estudiantes')
            ];
            
            selects.forEach(select => {
                if (select) {
                    // Guardar valor seleccionado
                    const valorActual = select.value;
                    select.innerHTML = '<option value="">Seleccionar curso</option>';
                    
                    // Agregar opciones
                    Object.keys(sistema.cursos).sort().forEach(codigoCurso => {
                        const curso = sistema.cursos[codigoCurso];
                        const option = document.createElement('option');
                        option.value = codigoCurso;
                        option.textContent = `${curso.nombre} (${codigoCurso})`;
                        select.appendChild(option);
                    });
                    
                    // Restaurar valor seleccionado si existe
                    if (valorActual && sistema.cursos[valorActual]) {
                        select.value = valorActual;
                    }
                }
            });
            
            // Actualizar tabla de cursos en configuraci√≥n
            const tablaCursos = document.getElementById('tabla-cursos');
            if (tablaCursos) {
                tablaCursos.innerHTML = '';
                
                Object.keys(sistema.cursos).sort().forEach(codigoCurso => {
                    const curso = sistema.cursos[codigoCurso];
                    const estudiantesCurso = sistema.estudiantes[codigoCurso] || [];
                    
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td><strong>${codigoCurso}</strong></td>
                        <td><input type="text" value="${curso.nombre}" data-codigo="${codigoCurso}" class="editar-curso-nombre" style="width: 100%; padding: 8px;"></td>
                        <td>${estudiantesCurso.length} estudiantes</td>
                        <td>${curso.puntosColectivos} puntos</td>
                        <td>
                            <button class="btn-small btn-warning btn-editar-curso" data-codigo="${codigoCurso}">‚úèÔ∏è Editar</button>
                            <button class="btn-small btn-danger btn-eliminar-curso" data-codigo="${codigoCurso}">üóëÔ∏è Eliminar</button>
                        </td>
                    `;
                    tablaCursos.appendChild(tr);
                });
                
                // Agregar eventos a los botones
                tablaCursos.querySelectorAll('.btn-editar-curso').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const codigo = this.getAttribute('data-codigo');
                        const curso = sistema.cursos[codigo];
                        const inputNombre = document.querySelector(`.editar-curso-nombre[data-codigo="${codigo}"]`);
                        
                        if (inputNombre && inputNombre.value.trim() !== curso.nombre) {
                            curso.nombre = inputNombre.value.trim();
                            guardarDatos();
                            actualizarListaCursos();
                            actualizarInterfazCompleta();
                            mostrarNotificacion(`Curso ${codigo} actualizado`);
                        }
                    });
                });
                
                tablaCursos.querySelectorAll('.btn-eliminar-curso').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const codigo = this.getAttribute('data-codigo');
                        const curso = sistema.cursos[codigo];
                        const estudiantesCurso = sistema.estudiantes[codigo] || [];
                        
                        mostrarConfirmacion(
                            'Eliminar Curso',
                            `¬øEst√° seguro de eliminar el curso ${curso.nombre}? Se eliminar√°n ${estudiantesCurso.length} estudiantes y todos sus registros.`,
                            function() {
                                eliminarCurso(codigo);
                            }
                        );
                    });
                });
            }
            
            // Actualizar filtro de estudiantes
            const filtroEstudiantes = document.getElementById('filtro-curso-estudiantes');
            if (filtroEstudiantes) {
                const valorActual = filtroEstudiantes.value;
                filtroEstudiantes.innerHTML = '<option value="">Todos los cursos</option>';
                
                Object.keys(sistema.cursos).sort().forEach(codigoCurso => {
                    const curso = sistema.cursos[codigoCurso];
                    const option = document.createElement('option');
                    option.value = codigoCurso;
                    option.textContent = `${curso.nombre} (${codigoCurso})`;
                    filtroEstudiantes.appendChild(option);
                });
                
                if (valorActual && sistema.cursos[valorActual]) {
                    filtroEstudiantes.value = valorActual;
                }
            }
        }

        function eliminarCurso(codigo) {
            const curso = sistema.cursos[codigo];
            
            delete sistema.cursos[codigo];
            delete sistema.estudiantes[codigo];
            
            // Filtrar registros y mediadores
            sistema.registros = sistema.registros.filter(registro => registro.curso !== codigo);
            sistema.mediadores = sistema.mediadores.filter(mediador => mediador.curso !== codigo);
            
            guardarDatos();
            actualizarListaCursos();
            actualizarInterfazCompleta();
            actualizarRankingCursos();
            
            mostrarNotificacion(`Curso ${curso.nombre} eliminado`, 'warning');
        }

        // ============================================
        // GESTI√ìN DE ESTUDIANTES
        // ============================================
        function actualizarTablaEstudiantes() {
            const filtroCurso = document.getElementById('filtro-curso-estudiantes');
            const tablaEstudiantes = document.getElementById('tabla-estudiantes');
            
            if (!tablaEstudiantes) return;
            
            let estudiantesMostrados = [];
            const cursoFiltrado = filtroCurso ? filtroCurso.value : '';
            
            Object.keys(sistema.estudiantes).forEach(codigoCurso => {
                if (cursoFiltrado && cursoFiltrado !== "" && cursoFiltrado !== codigoCurso) {
                    return;
                }
                
                const estudiantesCurso = sistema.estudiantes[codigoCurso];
                const curso = sistema.cursos[codigoCurso];
                
                if (estudiantesCurso && Array.isArray(estudiantesCurso)) {
                    estudiantesCurso.forEach(estudiante => {
                        if (estudiante && estudiante.id && estudiante.nombre) {
                            estudiantesMostrados.push({
                                cursoCodigo: codigoCurso,
                                cursoNombre: curso ? curso.nombre : codigoCurso,
                                estudiante: estudiante
                            });
                        }
                    });
                }
            });
            
            // Ordenar por nombre
            estudiantesMostrados.sort((a, b) => a.estudiante.nombre.localeCompare(b.estudiante.nombre));
            
            // Actualizar tabla
            tablaEstudiantes.innerHTML = '';
            
            if (estudiantesMostrados.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = '<td colspan="4" style="text-align: center; padding: 20px; color: #7f8c8d;">No hay estudiantes registrados</td>';
                tablaEstudiantes.appendChild(tr);
                return;
            }
            
            estudiantesMostrados.forEach((item) => {
                const estudiante = item.estudiante;
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${item.cursoNombre}</td>
                    <td>
                        <input type="text" value="${estudiante.nombre}" 
                               data-id="${estudiante.id}" 
                               class="editar-estudiante-nombre" 
                               style="width: 100%; padding: 8px;">
                    </td>
                    <td>
                        <input type="number" value="${estudiante.puntos || 0}" 
                               data-id="${estudiante.id}" 
                               class="editar-estudiante-puntos" 
                               style="width: 80px; padding: 8px;" 
                               min="0">
                    </td>
                    <td>
                        <button class="btn-small btn-warning editar-estudiante" data-id="${estudiante.id}">‚úèÔ∏è Guardar</button>
                        <button class="btn-small btn-danger eliminar-estudiante" data-id="${estudiante.id}">üóëÔ∏è Eliminar</button>
                    </td>
                `;
                tablaEstudiantes.appendChild(tr);
            });
            
            // Agregar eventos
            tablaEstudiantes.querySelectorAll('.editar-estudiante').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    editarEstudiante(id);
                });
            });
            
            tablaEstudiantes.querySelectorAll('.eliminar-estudiante').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    eliminarEstudianteConfirmar(id);
                });
            });
        }

        function editarEstudiante(id) {
            const [codigoCurso, numero] = id.split('-');
            const estudiantesCurso = sistema.estudiantes[codigoCurso];
            
            if (estudiantesCurso) {
                const estudiante = estudiantesCurso.find(e => e.id === id);
                if (estudiante) {
                    const inputNombre = document.querySelector(`.editar-estudiante-nombre[data-id="${id}"]`);
                    const inputPuntos = document.querySelector(`.editar-estudiante-puntos[data-id="${id}"]`);
                    
                    if (inputNombre) estudiante.nombre = inputNombre.value.trim();
                    if (inputPuntos) estudiante.puntos = parseInt(inputPuntos.value) || 0;
                    
                    guardarDatos();
                    actualizarMediadores();
                    actualizarInterfazCompleta();
                    mostrarNotificacion(`Estudiante ${estudiante.nombre} actualizado`);
                }
            }
        }

        function eliminarEstudianteConfirmar(id) {
            const [codigoCurso, numero] = id.split('-');
            const estudiantesCurso = sistema.estudiantes[codigoCurso];
            
            if (estudiantesCurso) {
                const estudiante = estudiantesCurso.find(e => e.id === id);
                if (estudiante) {
                    mostrarConfirmacion(
                        'Eliminar Estudiante',
                        `¬øEst√° seguro de eliminar a ${estudiante.nombre}? Se perder√°n todos sus registros.`,
                        function() {
                            eliminarEstudiante(id);
                        }
                    );
                }
            }
        }

        function eliminarEstudiante(id) {
            const [codigoCurso, numero] = id.split('-');
            const estudiantesCurso = sistema.estudiantes[codigoCurso];
            
            if (estudiantesCurso) {
                const index = estudiantesCurso.findIndex(e => e.id === id);
                if (index !== -1) {
                    const estudiante = estudiantesCurso[index];
                    
                    estudiantesCurso.splice(index, 1);
                    sistema.registros = sistema.registros.filter(registro => registro.estudianteId !== id);
                    sistema.mediadores = sistema.mediadores.filter(mediador => mediador.id !== id);
                    
                    guardarDatos();
                    actualizarTablaEstudiantes();
                    actualizarInterfazCompleta();
                    actualizarRankingCursos();
                    
                    mostrarNotificacion(`Estudiante ${estudiante.nombre} eliminado`, 'warning');
                }
            }
        }

        // ============================================
        // REGISTRO INDIVIDUAL DE CONDUCTAS
        // ============================================
        function inicializarRegistroIndividual() {
            const studentSearch = document.getElementById('student-search');
            const studentList = document.getElementById('student-list');
            const cursoSelect = document.getElementById('curso');
            const btnRegistrar = document.getElementById('btn-registrar');
            
            if (!studentSearch || !cursoSelect || !btnRegistrar) return;
            
            // Actualizar lista de estudiantes cuando se cambia el curso
            cursoSelect.addEventListener('change', function() {
                const cursoId = this.value;
                if (cursoId && sistema.estudiantes[cursoId]) {
                    mostrarListaEstudiantes(cursoId);
                } else {
                    studentList.classList.remove('active');
                }
                document.getElementById('estudiante-seleccionado').value = '';
                document.getElementById('selected-student').style.display = 'none';
            });
            
            // B√∫squeda de estudiantes
            studentSearch.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const cursoId = cursoSelect.value;
                
                if (!cursoId) {
                    mostrarNotificacion('Primero seleccione un curso', 'error');
                    return;
                }
                
                const estudiantes = sistema.estudiantes[cursoId];
                if (!estudiantes) return;
                
                const filtered = estudiantes.filter(est => 
                    est.nombre.toLowerCase().includes(searchTerm)
                );
                
                studentList.innerHTML = '';
                
                if (filtered.length === 0 && searchTerm.length > 0) {
                    const div = document.createElement('div');
                    div.className = 'student-item';
                    div.textContent = 'No se encontraron estudiantes';
                    div.style.color = '#7f8c8d';
                    div.style.fontStyle = 'italic';
                    studentList.appendChild(div);
                } else if (searchTerm.length === 0) {
                    mostrarListaEstudiantes(cursoId);
                    return;
                } else {
                    filtered.forEach(estudiante => {
                        const div = document.createElement('div');
                        div.className = 'student-item';
                        div.textContent = estudiante.nombre;
                        div.setAttribute('data-id', estudiante.id);
                        div.setAttribute('data-nombre', estudiante.nombre);
                        
                        div.addEventListener('click', function() {
                            seleccionarEstudiante(estudiante.id, estudiante.nombre);
                        });
                        
                        studentList.appendChild(div);
                    });
                }
                
                studentList.classList.add('active');
            });
            
            // Cerrar lista al hacer clic fuera
            document.addEventListener('click', function(e) {
                if (!studentSearch.contains(e.target) && !studentList.contains(e.target)) {
                    studentList.classList.remove('active');
                }
            });
            
            // Bot√≥n registrar
            btnRegistrar.addEventListener('click', function() {
                registrarConducta();
            });
        }

        function mostrarListaEstudiantes(cursoId) {
            const estudiantes = sistema.estudiantes[cursoId];
            const studentList = document.getElementById('student-list');
            
            if (!estudiantes || !studentList) return;
            
            studentList.innerHTML = '';
            
            estudiantes.forEach(estudiante => {
                const div = document.createElement('div');
                div.className = 'student-item';
                div.textContent = estudiante.nombre;
                div.setAttribute('data-id', estudiante.id);
                div.setAttribute('data-nombre', estudiante.nombre);
                
                div.addEventListener('click', function() {
                    seleccionarEstudiante(estudiante.id, estudiante.nombre);
                });
                
                studentList.appendChild(div);
            });
            
            studentList.classList.add('active');
        }

        function seleccionarEstudiante(id, nombre) {
            document.getElementById('estudiante-seleccionado').value = id;
            document.getElementById('student-search').value = nombre;
            document.getElementById('selected-student-name').textContent = nombre;
            document.getElementById('selected-student').style.display = 'block';
            
            // Remover selecci√≥n previa
            document.querySelectorAll('.student-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Marcar como seleccionado
            const items = document.querySelectorAll(`.student-item[data-id="${id}"]`);
            items.forEach(item => item.classList.add('selected'));
            
            document.getElementById('student-list').classList.remove('active');
        }

        function registrarConducta() {
            const cursoId = document.getElementById('curso').value;
            const estudianteId = document.getElementById('estudiante-seleccionado').value;
            const codigo = document.getElementById('codigo').value;
            const descripcion = document.getElementById('descripcion').value.trim();
            
            if (!cursoId || !estudianteId || !codigo) {
                mostrarNotificacion('Complete todos los campos obligatorios', 'error');
                return;
            }
            
            const estudiantesCurso = sistema.estudiantes[cursoId];
            const estudiante = estudiantesCurso.find(e => e.id === estudianteId);
            if (!estudiante) {
                mostrarNotificacion('Estudiante no encontrado', 'error');
                return;
            }
            
            const configCodigo = sistema.configuracion.puntosCodigos[codigo];
            if (!configCodigo) {
                mostrarNotificacion('C√≥digo no v√°lido', 'error');
                return;
            }
            
            const puntos = configCodigo.puntos;
            
            const registro = {
                id: Date.now(),
                fecha: new Date().toLocaleString(),
                curso: cursoId,
                estudianteId: estudianteId,
                estudianteNombre: estudiante.nombre,
                codigo: codigo,
                descripcion: descripcion,
                puntos: puntos
            };
            
            sistema.registros.push(registro);
            
            // Actualizar puntos individuales del estudiante
            estudiante.puntos += puntos;
            if (estudiante.puntos < 0) estudiante.puntos = 0;
            
            actualizarMediadores();
            
            guardarDatos();
            actualizarInterfazCompleta();
            actualizarRankingCursos();
            
            // Limpiar formulario
            document.getElementById('descripcion').value = '';
            document.getElementById('codigo').value = '';
            document.getElementById('estudiante-seleccionado').value = '';
            document.getElementById('student-search').value = '';
            document.getElementById('selected-student').style.display = 'none';
            
            mostrarNotificacion(`‚úÖ Registro guardado: ${estudiante.nombre} (${puntos > 0 ? '+' : ''}${puntos} puntos individuales)`);
        }

        // ============================================
        // EVALUACI√ìN COLECTIVA
        // ============================================
        function inicializarEvaluacionColectiva() {
            const sliders = document.querySelectorAll('.slider');
            const btnGuardarEvaluacion = document.getElementById('btn-guardar-evaluacion');
            
            if (!sliders.length || !btnGuardarEvaluacion) return;
            
            // Configurar sliders
            sliders.forEach(slider => {
                const valueElement = document.getElementById(`${slider.id}-value`);
                if (valueElement) {
                    slider.addEventListener('input', function() {
                        valueElement.textContent = `${this.value}/10`;
                        calcularPuntosEvaluacion();
                    });
                }
            });
            
            // Bot√≥n guardar evaluaci√≥n
            btnGuardarEvaluacion.addEventListener('click', function() {
                guardarEvaluacionColectiva();
            });
        }

        function calcularPuntosEvaluacion() {
            const clima = parseInt(document.getElementById('clima').value) || 0;
            const comportamiento = parseInt(document.getElementById('comportamiento').value) || 0;
            const aseo = parseInt(document.getElementById('aseo').value) || 0;
            const disciplina = parseInt(document.getElementById('disciplina').value) || 0;
            
            const total = clima + comportamiento + aseo + disciplina;
            const puntosCurso = total * sistema.configuracion.multiplicadorEvaluacion;
            
            const puntosTotalesElement = document.getElementById('puntos-totales');
            const puntosCursoElement = document.getElementById('puntos-curso');
            
            if (puntosTotalesElement) puntosTotalesElement.textContent = total;
            if (puntosCursoElement) puntosCursoElement.textContent = `${puntosCurso} puntos para el curso`;
            
            return { total, puntosCurso };
        }

        function guardarEvaluacionColectiva() {
            const cursoId = document.getElementById('curso-evaluacion').value;
            
            if (!cursoId) {
                mostrarNotificacion('Seleccione un curso', 'error');
                return;
            }
            
            const clima = parseInt(document.getElementById('clima').value) || 0;
            const comportamiento = parseInt(document.getElementById('comportamiento').value) || 0;
            const aseo = parseInt(document.getElementById('aseo').value) || 0;
            const disciplina = parseInt(document.getElementById('disciplina').value) || 0;
            
            const evaluacion = {
                semana: sistema.semanaActual,
                fecha: new Date().toLocaleDateString(),
                clima: clima,
                comportamiento: comportamiento,
                aseo: aseo,
                disciplina: disciplina,
                total: clima + comportamiento + aseo + disciplina,
                puntos: (clima + comportamiento + aseo + disciplina) * sistema.configuracion.multiplicadorEvaluacion
            };
            
            if (!sistema.cursos[cursoId].evaluaciones) {
                sistema.cursos[cursoId].evaluaciones = [];
            }
            sistema.cursos[cursoId].evaluaciones.push(evaluacion);
            
            sistema.cursos[cursoId].puntosColectivos += evaluacion.puntos;
            
            guardarDatos();
            actualizarInterfazCompleta();
            actualizarRankingCursos();
            
            // Resetear sliders
            const sliders = document.querySelectorAll('.slider');
            sliders.forEach(slider => {
                slider.value = 5;
                const valueElement = document.getElementById(`${slider.id}-value`);
                if (valueElement) valueElement.textContent = '5/10';
            });
            calcularPuntosEvaluacion();
            
            mostrarNotificacion(`‚úÖ Evaluaci√≥n guardada para ${sistema.cursos[cursoId].nombre} (+${evaluacion.puntos} puntos colectivos)`);
        }

        function actualizarHistorialEvaluaciones() {
            const tbody = document.getElementById('historial-evaluaciones');
            if (!tbody) return;
            
            let evaluacionesMostrar = [];
            
            Object.keys(sistema.cursos).forEach(cursoId => {
                const curso = sistema.cursos[cursoId];
                if (curso.evaluaciones && curso.evaluaciones.length > 0) {
                    curso.evaluaciones.forEach(evalItem => {
                        evaluacionesMostrar.push({
                            curso: curso.nombre,
                            cursoId: cursoId,
                            ...evalItem
                        });
                    });
                }
            });
            
            evaluacionesMostrar.sort((a, b) => b.semana - a.semana);
            
            tbody.innerHTML = '';
            
            if (evaluacionesMostrar.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8">No hay evaluaciones registradas</td></tr>';
                return;
            }
            
            evaluacionesMostrar.slice(0, 8).forEach(evalItem => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${evalItem.curso}</td>
                    <td>Semana ${evalItem.semana}</td>
                    <td>${evalItem.clima}/10</td>
                    <td>${evalItem.comportamiento}/10</td>
                    <td>${evalItem.aseo}/10</td>
                    <td>${evalItem.disciplina}/10</td>
                    <td><strong>${evalItem.total}/40</strong></td>
                    <td><span style="color: var(--success); font-weight: bold;">+${evalItem.puntos}</span></td>
                `;
                tbody.appendChild(tr);
            });
        }

        // ============================================
        // RANKING DE CURSOS - ACTUALIZADO SIN PUNTOS INDIVIDUALES
        // ============================================
        function actualizarRankingCursos() {
            // Calcular estad√≠sticas
            const cursosArray = Object.keys(sistema.cursos).map(cursoId => {
                const curso = sistema.cursos[cursoId];
                
                const mediadoresCurso = sistema.mediadores.filter(m => m.curso === cursoId);
                const bonusMediadores = mediadoresCurso.reduce((total, m) => total + m.bonus, 0);
                
                const puntosTotales = curso.puntosColectivos + bonusMediadores;
                
                return {
                    id: cursoId,
                    nombre: curso.nombre,
                    puntosColectivos: curso.puntosColectivos,
                    bonusMediadores: bonusMediadores,
                    puntosTotales: puntosTotales,
                    mediadores: mediadoresCurso,
                    numMediadores: mediadoresCurso.length
                };
            });
            
            // Ordenar por puntos totales
            cursosArray.sort((a, b) => b.puntosTotales - a.puntosTotales);
            
            // Actualizar estad√≠sticas
            const totalCursosElement = document.getElementById('total-cursos-ranking');
            const puntosTotalesElement = document.getElementById('puntos-totales-ranking');
            const cursoLiderElement = document.getElementById('curso-lider');
            const diferenciaMinElement = document.getElementById('diferencia-min');
            
            if (totalCursosElement) totalCursosElement.textContent = cursosArray.length;
            
            const puntosTotalesSistema = cursosArray.reduce((total, curso) => total + curso.puntosTotales, 0);
            if (puntosTotalesElement) puntosTotalesElement.textContent = puntosTotalesSistema;
            
            if (cursoLiderElement && cursosArray.length > 0) {
                cursoLiderElement.textContent = cursosArray[0].nombre;
                
                if (diferenciaMinElement && cursosArray.length > 1) {
                    const diferencia = cursosArray[0].puntosTotales - cursosArray[1].puntosTotales;
                    diferenciaMinElement.textContent = diferencia;
                }
            }
            
            // Actualizar tabla de ranking
            const tbody = document.getElementById('cuerpo-tabla-ranking');
            if (tbody) {
                tbody.innerHTML = '';
                
                if (cursosArray.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6">No hay cursos registrados</td></tr>';
                    return;
                }
                
                cursosArray.forEach((curso, index) => {
                    const tr = document.createElement('tr');
                    
                    // Determinar medalla
                    let medalla = '';
                    if (index === 0) medalla = 'ü•á';
                    else if (index === 1) medalla = 'ü•à';
                    else if (index === 2) medalla = 'ü•â';
                    else medalla = `${index + 1}¬∫`;
                    
                    // Contar mediadores por nivel
                    const mediadoresNivel3 = curso.mediadores.filter(m => m.nivel === 3).length;
                    const mediadoresNivel2 = curso.mediadores.filter(m => m.nivel === 2).length;
                    const mediadoresNivel1 = curso.mediadores.filter(m => m.nivel === 1).length;
                    
                    let mediadoresHtml = '';
                    if (curso.numMediadores > 0) {
                        mediadoresHtml = `
                            <div style="font-size: 0.9rem;">
                                <div>üèÜ ${mediadoresNivel3} | ‚öîÔ∏è ${mediadoresNivel2} | üéÆ ${mediadoresNivel1}</div>
                                <div style="font-size: 0.8rem; color: #7f8c8d;">${curso.numMediadores} total</div>
                            </div>
                        `;
                    } else {
                        mediadoresHtml = '<span style="color: #7f8c8d;">Sin mediadores</span>';
                    }
                    
                    tr.innerHTML = `
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 1.5rem;">${medalla}</span>
                                <span style="font-weight: bold; font-size: 1.2rem;">${index + 1}¬∫</span>
                            </div>
                        </td>
                        <td>
                            <strong>${curso.nombre}</strong><br>
                            <small style="color: #7f8c8d;">${curso.id}</small>
                        </td>
                        <td>
                            <span style="font-size: 1.5rem; font-weight: bold; color: var(--success);">${curso.puntosTotales}</span>
                        </td>
                        <td>
                            <span style="color: var(--secondary);">${curso.puntosColectivos}</span>
                            <div style="font-size: 0.8rem; color: #7f8c8d;">Colectivos</div>
                        </td>
                        <td>
                            <span style="color: var(--warning);">+${curso.bonusMediadores}</span>
                            <div style="font-size: 0.8rem; color: #7f8c8d;">Bonus</div>
                        </td>
                        <td>
                            ${mediadoresHtml}
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            }
            
            // Actualizar gr√°fico
            generarGraficoRanking(cursosArray);
            
            // Actualizar ranking general
            actualizarRanking();
            
            // Actualizar cursos ganadores de premios
            actualizarCursosPremiados(cursosArray);
        }

        function generarGraficoRanking(cursosArray) {
            const graficoDiv = document.getElementById('grafico-evolucion');
            if (!graficoDiv) return;
            
            let contenedorBarras = graficoDiv.querySelector('.grafico-barras-container');
            
            if (!contenedorBarras) {
                contenedorBarras = document.createElement('div');
                contenedorBarras.className = 'grafico-barras-container';
                contenedorBarras.style.cssText = 'display: flex; justify-content: space-around; align-items: flex-end; height: 200px; margin-top: 30px; padding: 0 20px;';
                graficoDiv.appendChild(contenedorBarras);
            }
            
            contenedorBarras.innerHTML = '';
            
            if (cursosArray.length === 0) {
                graficoDiv.innerHTML = '<p style="text-align: center; color: #7f8c8d; padding: 50px 0;">No hay datos para mostrar</p>';
                return;
            }
            
            // Tomar solo los primeros 6 cursos
            const cursosParaGrafico = cursosArray.slice(0, 6);
            const maxPuntos = Math.max(...cursosParaGrafico.map(curso => curso.puntosTotales));
            const alturaMaxima = maxPuntos > 0 ? 180 : 100;
            
            cursosParaGrafico.forEach((curso, index) => {
                const alturaBarra = maxPuntos > 0 ? (curso.puntosTotales / maxPuntos) * alturaMaxima : 20;
                
                const barraDiv = document.createElement('div');
                barraDiv.style.cssText = 'display: flex; flex-direction: column; align-items: center; width: 60px; margin: 0 5px;';
                
                // Color seg√∫n posici√≥n
                let colorBarra = '';
                if (index === 0) colorBarra = 'linear-gradient(135deg, #f7dc6f, #f1c40f)';
                else if (index === 1) colorBarra = 'linear-gradient(135deg, #c0c0c0, #95a5a6)';
                else if (index === 2) colorBarra = 'linear-gradient(135deg, #cd7f32, #a04000)';
                else colorBarra = 'linear-gradient(135deg, #3498db, #2980b9)';
                
                barraDiv.innerHTML = `
                    <div style="background: ${colorBarra}; height: ${alturaBarra}px; width: 80%; border-radius: 8px 8px 0 0; margin-bottom: 8px; display: flex; align-items: flex-end; justify-content: center;">
                        <span style="color: white; font-weight: bold; font-size: 0.9rem; padding-bottom: 5px;">${curso.puntosTotales}</span>
                    </div>
                    <div style="font-size: 0.8rem; text-align: center; font-weight: 600; color: var(--primary);">
                        ${curso.nombre.split(' ')[0]}
                    </div>
                    <div style="font-size: 0.7rem; color: #7f8c8d; margin-top: 2px;">
                        ${index + 1}¬∫ lugar
                    </div>
                `;
                
                contenedorBarras.appendChild(barraDiv);
            });
        }

        // ============================================
        // FUNCI√ìN NUEVA: CURSOS GANADORES DE PREMIOS
        // ============================================
        function actualizarCursosPremiados(cursosArray) {
            const container = document.getElementById('cursos-premiados-container');
            const sinPremiosMsg = document.getElementById('sin-premios-msg');
            
            if (!container || !sinPremiosMsg) return;
            
            container.innerHTML = '';
            
            // Ordenar premios colectivos por puntos requeridos (de mayor a menor)
            const premiosColectivos = [...sistema.configuracion.premiosColectivos].sort((a, b) => b.puntos - a.puntos);
            
            let hayPremiosOtorgados = false;
            
            // Para cada premio, verificar qu√© cursos lo han ganado
            premiosColectivos.forEach(premio => {
                const cursosGanadores = cursosArray.filter(curso => curso.puntosTotales >= premio.puntos);
                
                if (cursosGanadores.length > 0) {
                    hayPremiosOtorgados = true;
                    
                    // Determinar clase CSS seg√∫n el nivel del premio
                    let clasePremio = 'premio-card';
                    if (premio.puntos >= 700) clasePremio += ' oro';
                    else if (premio.puntos >= 500) clasePremio += ' plata';
                    else clasePremio += ' bronce';
                    
                    // Crear tarjeta de premio
                    const premioDiv = document.createElement('div');
                    premioDiv.className = clasePremio;
                    
                    // Determinar emoji seg√∫n nivel
                    let emoji = 'üèÖ';
                    if (premio.puntos >= 700) emoji = 'ü•á';
                    else if (premio.puntos >= 500) emoji = 'ü•à';
                    else if (premio.puntos >= 300) emoji = 'ü•â';
                    
                    let cursosHtml = '';
                    cursosGanadores.forEach(curso => {
                        cursosHtml += `
                            <div class="curso-premiado">
                                <div class="nombre-curso">${curso.nombre}</div>
                                <div>Puntos: <span class="puntos-curso">${curso.puntosTotales}</span> / ${premio.puntos} requeridos</div>
                                <div style="font-size: 0.8rem; color: #7f8c8d; margin-top: 5px;">
                                    ${curso.puntosColectivos} puntos colectivos + ${curso.bonusMediadores} bonus mediadores
                                </div>
                            </div>
                        `;
                    });
                    
                    premioDiv.innerHTML = `
                        <div class="premio-header">
                            <div class="premio-emoji">${emoji}</div>
                            <div style="text-align: right; font-size: 0.9rem; color: #7f8c8d;">
                                ${cursosGanadores.length} curso(s) ganador(es)
                            </div>
                        </div>
                        <div class="premio-nombre">${premio.premio}</div>
                        <div class="premio-descripcion">${premio.descripcion}</div>
                        <div style="margin-top: 15px;">
                            <div style="font-size: 0.9rem; color: #7f8c8d; margin-bottom: 10px;">
                                <strong>${premio.puntos}+ puntos</strong> requeridos
                            </div>
                            ${cursosHtml}
                        </div>
                    `;
                    
                    container.appendChild(premioDiv);
                }
            });
            
            // Mostrar mensaje si no hay premios otorgados
            if (hayPremiosOtorgados) {
                sinPremiosMsg.style.display = 'none';
            } else {
                sinPremiosMsg.style.display = 'block';
            }
        }

        // ============================================
        // SISTEMA DE MEDIADORES
        // ============================================
        function determinarNivelMediador(puntos) {
            const niveles = [...sistema.configuracion.nivelesMediadores].sort((a, b) => b.puntosMin - a.puntosMin);
            
            for (const nivel of niveles) {
                if (puntos >= nivel.puntosMin) {
                    let color = 'success';
                    if (nivel.puntosMin >= 300) color = 'warning';
                    else if (nivel.puntosMin >= 200) color = 'secondary';
                    
                    const nivelIndex = sistema.configuracion.nivelesMediadores.findIndex(n => n.puntosMin === nivel.puntosMin);
                    
                    return { 
                        nivel: nivelIndex + 1, 
                        nombre: nivel.nombre, 
                        bonus: nivel.bonus, 
                        color: color,
                        puntosMin: nivel.puntosMin
                    };
                }
            }
            return null;
        }

        function actualizarMediadores() {
            sistema.mediadores = [];
            
            Object.keys(sistema.estudiantes).forEach(cursoId => {
                const estudiantesCurso = sistema.estudiantes[cursoId];
                
                if (!estudiantesCurso) return;
                
                // Ordenar estudiantes por puntos (descendente)
                const estudiantesOrdenados = [...estudiantesCurso].sort((a, b) => b.puntos - a.puntos);
                
                // Contadores de mediadores por nivel
                const contadores = { 1: 0, 2: 0, 3: 0 };
                
                estudiantesOrdenados.forEach(estudiante => {
                    const nivelInfo = determinarNivelMediador(estudiante.puntos);
                    
                    if (nivelInfo && contadores[nivelInfo.nivel] < sistema.configuracion.maxMediadoresPorNivel) {
                        sistema.mediadores.push({
                            id: estudiante.id,
                            nombre: estudiante.nombre,
                            curso: cursoId,
                            puntos: estudiante.puntos,
                            nivel: nivelInfo.nivel,
                            nivelNombre: nivelInfo.nombre,
                            bonus: nivelInfo.bonus,
                            color: nivelInfo.color
                        });
                        contadores[nivelInfo.nivel]++;
                    }
                });
            });
        }

        function actualizarTablaMediadores() {
            const tbody = document.getElementById('tabla-mediadores');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (sistema.mediadores.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5">No hay mediadores registrados</td></tr>';
                return;
            }
            
            // Ordenar mediadores
            sistema.mediadores.sort((a, b) => {
                if (b.nivel !== a.nivel) return b.nivel - a.nivel;
                return b.puntos - a.puntos;
            });
            
            sistema.mediadores.forEach(mediador => {
                const tr = document.createElement('tr');
                
                let nivelBadge = '';
                if (mediador.nivel === 3) nivelBadge = 'üèÜ';
                else if (mediador.nivel === 2) nivelBadge = '‚öîÔ∏è';
                else nivelBadge = 'üéÆ';
                
                tr.innerHTML = `
                    <td>${sistema.cursos[mediador.curso]?.nombre || mediador.curso}</td>
                    <td><strong>${mediador.nombre}</strong></td>
                    <td>${nivelBadge} ${mediador.nivelNombre}</td>
                    <td>${mediador.puntos} puntos individuales</td>
                    <td><span style="color: var(--${mediador.color}); font-weight: bold;">+${mediador.bonus}/semana al curso</span></td>
                `;
                tbody.appendChild(tr);
            });
        }

        function actualizarRanking() {
            const tbody = document.getElementById('tabla-ranking');
            if (!tbody) return;
            
            const cursosArray = Object.keys(sistema.cursos).map(cursoId => {
                const curso = sistema.cursos[cursoId];
                
                const mediadoresCurso = sistema.mediadores.filter(m => m.curso === cursoId);
                const bonusMediadores = mediadoresCurso.reduce((total, m) => total + m.bonus, 0);
                
                const puntosTotales = curso.puntosColectivos + bonusMediadores;
                
                return {
                    id: cursoId,
                    nombre: curso.nombre,
                    puntosColectivos: curso.puntosColectivos,
                    bonusMediadores: bonusMediadores,
                    puntosTotales: puntosTotales,
                    mediadores: mediadoresCurso
                };
            });
            
            cursosArray.sort((a, b) => b.puntosTotales - a.puntosTotales);
            
            tbody.innerHTML = '';
            
            cursosArray.forEach((curso, index) => {
                const tr = document.createElement('tr');
                
                const mediadoresNivel3 = curso.mediadores.filter(m => m.nivel === 3).length;
                const mediadoresNivel2 = curso.mediadores.filter(m => m.nivel === 2).length;
                const mediadoresNivel1 = curso.mediadores.filter(m => m.nivel === 1).length;
                
                let mediadoresHtml = '';
                if (curso.mediadores.length > 0) {
                    mediadoresHtml = `
                        <div style="font-size: 0.9rem;">
                            <div>üèÜ ${mediadoresNivel3} | ‚öîÔ∏è ${mediadoresNivel2} | üéÆ ${mediadoresNivel1}</div>
                            <div style="font-size: 0.8rem; color: #7f8c8d;">${curso.mediadores.length} mediadores</div>
                        </div>
                    `;
                } else {
                    mediadoresHtml = 'Sin mediadores';
                }
                
                tr.innerHTML = `
                    <td><strong>${index + 1}¬∫</strong></td>
                    <td><strong>${curso.nombre}</strong></td>
                    <td>
                        <span style="color: var(--secondary);">${curso.puntosColectivos}</span><br>
                        <small style="color: #7f8c8d;">Puntos colectivos</small>
                    </td>
                    <td>
                        <span style="color: var(--warning);">+${curso.bonusMediadores}</span><br>
                        <small style="color: #7f8c8d;">Bonus mediadores</small>
                    </td>
                    <td>
                        <span style="color: var(--success); font-weight: bold;">${curso.puntosTotales}</span><br>
                        <small style="color: #7f8c8d;">Total del curso</small>
                    </td>
                    <td>${mediadoresHtml}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function actualizarEstadisticas() {
            const elementos = {
                'total-cursos': document.getElementById('total-cursos'),
                'total-mediadores': document.getElementById('total-mediadores'),
                'total-puntos': document.getElementById('total-puntos'),
                'semana-actual': document.getElementById('semana-actual')
            };
            
            if (elementos['total-cursos']) {
                elementos['total-cursos'].textContent = Object.keys(sistema.cursos).length;
            }
            
            if (elementos['total-mediadores']) {
                elementos['total-mediadores'].textContent = sistema.mediadores.length;
            }
            
            if (elementos['total-puntos']) {
                const totalPuntos = Object.keys(sistema.cursos).reduce((total, cursoId) => {
                    const curso = sistema.cursos[cursoId];
                    const mediadoresCurso = sistema.mediadores.filter(m => m.curso === cursoId);
                    const bonusMediadores = mediadoresCurso.reduce((sum, m) => sum + m.bonus, 0);
                    return total + curso.puntosColectivos + bonusMediadores;
                }, 0);
                elementos['total-puntos'].textContent = totalPuntos;
            }
            
            if (elementos['semana-actual']) {
                elementos['semana-actual'].textContent = sistema.semanaActual;
            }
        }

        // ============================================
        // INTERFAZ COMPLETA
        // ============================================
        function actualizarInterfazCompleta() {
            actualizarListaCursos();
            actualizarMediadores();
            actualizarRanking();
            actualizarEstadisticas();
            actualizarHistorialEvaluaciones();
            actualizarTablaMediadores();
            calcularPuntosEvaluacion();
            actualizarRankingCursos();
            actualizarContenidoInformacion();
            actualizarContenidoRegistro();
            actualizarConfiguracionCompleta();
        }

        function actualizarContenidoRegistro() {
            // Actualizar select de c√≥digos
            const selectCodigo = document.getElementById('codigo');
            if (selectCodigo) {
                selectCodigo.innerHTML = '<option value="">Seleccionar c√≥digo</option>';
                
                const codigosPositivos = [];
                const codigosNegativos = [];
                
                Object.keys(sistema.configuracion.puntosCodigos).forEach(codigo => {
                    const config = sistema.configuracion.puntosCodigos[codigo];
                    const option = `<option value="${codigo}">${config.tipo === 'positiva' ? '‚úÖ' : '‚ùå'} ${codigo} - ${config.nombre} (${config.puntos > 0 ? '+' : ''}${config.puntos} pts individuales)</option>`;
                    
                    if (config.tipo === 'positiva') {
                        codigosPositivos.push(option);
                    } else {
                        codigosNegativos.push(option);
                    }
                });
                
                if (codigosPositivos.length > 0) {
                    selectCodigo.innerHTML += `<optgroup label="Conductas Positivas">${codigosPositivos.join('')}</optgroup>`;
                }
                if (codigosNegativos.length > 0) {
                    selectCodigo.innerHTML += `<optgroup label="Conductas Negativas (Canje)">${codigosNegativos.join('')}</optgroup>`;
                }
            }
            
            // Actualizar contenedor de c√≥digos
            const codigosContainer = document.getElementById('codigos-container');
            if (codigosContainer) {
                codigosContainer.innerHTML = '';
                
                Object.keys(sistema.configuracion.puntosCodigos).forEach(codigo => {
                    const config = sistema.configuracion.puntosCodigos[codigo];
                    
                    const div = document.createElement('div');
                    div.style.cssText = 'padding: 15px; background: #e8f6f3; border-radius: 8px; border-left: 4px solid var(--success);';
                    
                    div.innerHTML = `
                        <strong>${config.tipo === 'positiva' ? '‚úÖ' : '‚ùå'} ${codigo} - ${config.nombre}</strong><br>
                        <span style="color: ${config.tipo === 'positiva' ? 'var(--success)' : 'var(--danger)'}; font-weight: bold;">${config.puntos > 0 ? '+' : ''}${config.puntos} puntos individuales</span><br>
                        <small>${config.descripcion}</small>
                    `;
                    
                    codigosContainer.appendChild(div);
                });
            }
        }

        function actualizarContenidoInformacion() {
            // Puntos individuales
            const puntosIndividualesContainer = document.getElementById('puntos-individuales-container');
            if (puntosIndividualesContainer) {
                puntosIndividualesContainer.innerHTML = '';
                
                Object.keys(sistema.configuracion.puntosCodigos).forEach(codigo => {
                    const config = sistema.configuracion.puntosCodigos[codigo];
                    
                    const div = document.createElement('div');
                    div.style.cssText = 'padding: 15px; background: #f8f9fa; border-radius: 8px;';
                    
                    div.innerHTML = `
                        <strong>${codigo} - ${config.nombre}</strong><br>
                        <span style="color: ${config.tipo === 'positiva' ? 'var(--success)' : 'var(--danger)'};">${config.puntos > 0 ? '+' : ''}${config.puntos} puntos</span>
                    `;
                    
                    puntosIndividualesContainer.appendChild(div);
                });
            }
            
            // Niveles de mediadores
            const mediatorLevelsContainer = document.getElementById('mediator-levels-container');
            if (mediatorLevelsContainer) {
                mediatorLevelsContainer.innerHTML = '';
                
                sistema.configuracion.nivelesMediadores.forEach((nivel, index) => {
                    const div = document.createElement('div');
                    div.className = 'mediator-card';
                    div.classList.add(`level-${index + 1}`);
                    
                    let badgeClass = '';
                    if (index === 0) badgeClass = 'badge-level-1';
                    else if (index === 1) badgeClass = 'badge-level-2';
                    else badgeClass = 'badge-level-3';
                    
                    let nivelEmoji = '';
                    if (index === 0) nivelEmoji = 'üéÆ';
                    else if (index === 1) nivelEmoji = '‚öîÔ∏è';
                    else nivelEmoji = 'üèÜ';
                    
                    div.innerHTML = `
                        <div class="level-badge ${badgeClass}">${nivelEmoji} NIVEL ${index + 1}</div>
                        <h4 style="color: ${index === 0 ? 'var(--success)' : index === 1 ? 'var(--secondary)' : 'var(--warning)'}; margin-bottom: 10px;">${nivel.nombre.toUpperCase()}</h4>
                        <p><strong>Requisito:</strong> ${nivel.puntosMin}+ puntos individuales</p>
                        <p><strong>Bonus al curso:</strong> +${nivel.bonus} puntos/semana</p>
                        <div style="margin-top: 15px; padding: 10px; background: white; border-radius: 5px;">
                            <small>${nivel.descripcion}</small>
                        </div>
                    `;
                    
                    mediatorLevelsContainer.appendChild(div);
                });
            }
            
            // Premios individuales
            const premiosIndividualesContainer = document.getElementById('premios-individuales-container');
            if (premiosIndividualesContainer) {
                premiosIndividualesContainer.innerHTML = '';
                
                sistema.configuracion.premiosIndividuales.forEach(premio => {
                    const div = document.createElement('div');
                    
                    let bgColor = 'linear-gradient(135deg, #fef9e7, #fcf3cf)';
                    let textColor = '#cd7f32';
                    
                    if (premio.medalla.includes('ü•à')) {
                        bgColor = 'linear-gradient(135deg, #f8f9fa, #e9ecef)';
                        textColor = '#c0c0c0';
                    } else if (premio.medalla.includes('ü•á')) {
                        bgColor = 'linear-gradient(135deg, #fff3cd, #f7dc6f)';
                        textColor = '#ffd700';
                    }
                    
                    div.style.cssText = `padding: 15px; background: ${bgColor}; border-radius: 8px; text-align: center;`;
                    
                    div.innerHTML = `
                        <strong style="color: ${textColor}; font-size: 1.2rem;">${premio.medalla} ${premio.nombre}</strong><br>
                        <small>${premio.puntosMin}+ puntos individuales</small><br>
                        <span style="font-size: 0.9rem;">${premio.descripcion}</span>
                    `;
                    
                    premiosIndividualesContainer.appendChild(div);
                });
            }
            
            // Premios colectivos
            const premiosColectivosContainer = document.getElementById('premios-colectivos-container');
            if (premiosColectivosContainer) {
                premiosColectivosContainer.innerHTML = '';
                
                sistema.configuracion.premiosColectivos.forEach(premio => {
                    const div = document.createElement('div');
                    div.style.cssText = 'padding: 15px; background: #e8f6f3; border-radius: 8px; text-align: center;';
                    
                    div.innerHTML = `
                        <strong>${premio.puntos} puntos del curso</strong><br>
                        <span style="color: var(--success); font-size: 1.1rem;">${premio.premio}</span><br>
                        <span style="font-size: 0.9rem;">${premio.descripcion}</span>
                    `;
                    
                    premiosColectivosContainer.appendChild(div);
                });
            }
        }

        // ============================================
        // CONFIGURACI√ìN COMPLETA
        // ============================================
        function actualizarConfiguracionCompleta() {
            if (!autenticado) return;
            
            actualizarEstadoSesion();
            actualizarTablaCodigos();
            actualizarTablaNiveles();
            actualizarTablaPremios();
            actualizarEstadisticasSistema();
            
            // Configurar eventos de los botones
            const btnCambiarPin = document.getElementById('btn-cambiar-pin');
            if (btnCambiarPin) {
                btnCambiarPin.addEventListener('click', function() {
                    const nuevoPin1 = document.getElementById('nuevo-pin-1').value;
                    const nuevoPin2 = document.getElementById('nuevo-pin-2').value;
                    
                    if (!nuevoPin1 || !nuevoPin2) {
                        mostrarNotificacion('Complete ambos campos del PIN', 'error');
                        return;
                    }
                    
                    if (nuevoPin1.length !== 4) {
                        mostrarNotificacion('El PIN debe tener exactamente 4 d√≠gitos', 'error');
                        return;
                    }
                    
                    if (!/^\d{4}$/.test(nuevoPin1)) {
                        mostrarNotificacion('El PIN solo puede contener n√∫meros', 'error');
                        return;
                    }
                    
                    if (nuevoPin1 !== nuevoPin2) {
                        mostrarNotificacion('Los PIN no coinciden', 'error');
                        return;
                    }
                    
                    if (nuevoPin1 === sistema.seguridad.pin) {
                        mostrarNotificacion('El nuevo PIN no puede ser igual al actual', 'error');
                        return;
                    }
                    
                    sistema.seguridad.pin = nuevoPin1;
                    sistema.seguridad.pinConfigurado = true;
                    
                    guardarDatos();
                    actualizarEstadoSesion();
                    
                    document.getElementById('nuevo-pin-1').value = '';
                    document.getElementById('nuevo-pin-2').value = '';
                    
                    mostrarNotificacion('‚úÖ PIN cambiado correctamente', 'success');
                });
            }
            
            const btnCerrarSesion = document.getElementById('btn-cerrar-sesion');
            if (btnCerrarSesion) {
                btnCerrarSesion.addEventListener('click', function() {
                    mostrarConfirmacion(
                        'Cerrar Sesi√≥n',
                        '¬øEst√° seguro de cerrar la sesi√≥n de configuraci√≥n? Deber√° ingresar el PIN nuevamente para acceder.',
                        function() {
                            autenticado = false;
                            sesionIniciada = null;
                            sessionStorage.removeItem('sesionConfiguracion');
                            document.getElementById('config-tab').classList.add('disabled');
                            
                            if (document.querySelector('.tab.active').getAttribute('data-tab') === 'config') {
                                document.querySelector('.tab[data-tab="registro"]').click();
                            }
                            
                            document.getElementById('pin-overlay').classList.remove('hidden');
                            mostrarNotificacion('Sesi√≥n de configuraci√≥n cerrada', 'info');
                        }
                    );
                });
            }
        }

        function actualizarTablaCodigos() {
            const tablaCodigos = document.getElementById('tabla-codigos');
            if (!tablaCodigos) return;
            
            tablaCodigos.innerHTML = '';
            
            Object.keys(sistema.configuracion.puntosCodigos).forEach(codigo => {
                const config = sistema.configuracion.puntosCodigos[codigo];
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><strong>${codigo}</strong></td>
                    <td><input type="text" value="${config.nombre}" data-codigo="${codigo}" class="editar-codigo-nombre" style="width: 100%; padding: 8px;"></td>
                    <td>
                        <select data-codigo="${codigo}" class="editar-codigo-tipo" style="padding: 8px;">
                            <option value="positiva" ${config.tipo === 'positiva' ? 'selected' : ''}>Positiva</option>
                            <option value="negativa" ${config.tipo === 'negativa' ? 'selected' : ''}>Negativa</option>
                        </select>
                    </td>
                    <td><input type="number" value="${config.puntos}" data-codigo="${codigo}" class="editar-codigo-puntos" style="width: 80px; padding: 8px;"></td>
                    <td><input type="text" value="${config.descripcion}" data-codigo="${codigo}" class="editar-codigo-desc" style="width: 100%; padding: 8px;"></td>
                    <td>
                        <button class="btn-small btn-warning guardar-codigo" data-codigo="${codigo}">üíæ Guardar</button>
                        <button class="btn-small btn-danger eliminar-codigo" data-codigo="${codigo}">üóëÔ∏è Eliminar</button>
                    </td>
                `;
                tablaCodigos.appendChild(tr);
            });
            
            // Configurar eventos
            tablaCodigos.querySelectorAll('.guardar-codigo').forEach(btn => {
                btn.addEventListener('click', function() {
                    const codigo = this.getAttribute('data-codigo');
                    guardarCodigo(codigo);
                });
            });
            
            tablaCodigos.querySelectorAll('.eliminar-codigo').forEach(btn => {
                btn.addEventListener('click', function() {
                    const codigo = this.getAttribute('data-codigo');
                    eliminarCodigoConfirmar(codigo);
                });
            });
            
            // Actualizar valores de configuraci√≥n
            const multEvaluacion = document.getElementById('mult-evaluacion');
            const maxMediadoresNivel = document.getElementById('max-mediadores-nivel');
            
            if (multEvaluacion) multEvaluacion.value = sistema.configuracion.multiplicadorEvaluacion;
            if (maxMediadoresNivel) maxMediadoresNivel.value = sistema.configuracion.maxMediadoresPorNivel;
            
            const btnGuardarConfigPuntos = document.getElementById('btn-guardar-config-puntos');
            if (btnGuardarConfigPuntos) {
                btnGuardarConfigPuntos.addEventListener('click', function() {
                    const multiplicador = parseFloat(document.getElementById('mult-evaluacion').value) || 2;
                    const maxMediadores = parseInt(document.getElementById('max-mediadores-nivel').value) || 3;
                    
                    sistema.configuracion.multiplicadorEvaluacion = multiplicador;
                    sistema.configuracion.maxMediadoresPorNivel = maxMediadores;
                    
                    guardarDatos();
                    actualizarInterfazCompleta();
                    
                    mostrarNotificacion('Configuraci√≥n de puntos guardada');
                });
            }
        }

        function guardarCodigo(codigo) {
            const config = sistema.configuracion.puntosCodigos[codigo];
            if (!config) return;
            
            const inputNombre = document.querySelector(`.editar-codigo-nombre[data-codigo="${codigo}"]`);
            const selectTipo = document.querySelector(`.editar-codigo-tipo[data-codigo="${codigo}"]`);
            const inputPuntos = document.querySelector(`.editar-codigo-puntos[data-codigo="${codigo}"]`);
            const inputDesc = document.querySelector(`.editar-codigo-desc[data-codigo="${codigo}"]`);
            
            if (inputNombre) config.nombre = inputNombre.value.trim();
            if (selectTipo) config.tipo = selectTipo.value;
            if (inputPuntos) config.puntos = parseInt(inputPuntos.value) || 0;
            if (inputDesc) config.descripcion = inputDesc.value.trim();
            
            guardarDatos();
            actualizarContenidoRegistro();
            mostrarNotificacion(`C√≥digo ${codigo} actualizado`);
        }

        function eliminarCodigoConfirmar(codigo) {
            const config = sistema.configuracion.puntosCodigos[codigo];
            if (!config) return;
            
            mostrarConfirmacion(
                'Eliminar C√≥digo',
                `¬øEst√° seguro de eliminar el c√≥digo ${codigo} - ${config.nombre}?`,
                function() {
                    delete sistema.configuracion.puntosCodigos[codigo];
                    guardarDatos();
                    actualizarTablaCodigos();
                    actualizarContenidoRegistro();
                    mostrarNotificacion(`C√≥digo ${codigo} eliminado`, 'warning');
                }
            );
        }

        function actualizarTablaNiveles() {
            const tablaNiveles = document.getElementById('tabla-niveles');
            if (!tablaNiveles) return;
            
            tablaNiveles.innerHTML = '';
            
            sistema.configuracion.nivelesMediadores.forEach((nivel, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><strong>${index + 1}</strong></td>
                    <td><input type="text" value="${nivel.nombre}" data-index="${index}" class="editar-nivel-nombre" style="width: 100%; padding: 8px;"></td>
                    <td><input type="number" value="${nivel.puntosMin}" data-index="${index}" class="editar-nivel-puntos" style="width: 100px; padding: 8px;" min="0"></td>
                    <td><input type="number" value="${nivel.bonus}" data-index="${index}" class="editar-nivel-bonus" style="width: 100px; padding: 8px;" min="0"></td>
                    <td><input type="text" value="${nivel.descripcion}" data-index="${index}" class="editar-nivel-desc" style="width: 100%; padding: 8px;"></td>
                    <td>
                        <button class="btn-small btn-warning guardar-nivel" data-index="${index}">üíæ Guardar</button>
                        ${index > 0 ? `<button class="btn-small btn-danger eliminar-nivel" data-index="${index}">üóëÔ∏è Eliminar</button>` : ''}
                    </td>
                `;
                tablaNiveles.appendChild(tr);
            });
            
            // Configurar eventos
            tablaNiveles.querySelectorAll('.guardar-nivel').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    guardarNivel(index);
                });
            });
            
            tablaNiveles.querySelectorAll('.eliminar-nivel').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    eliminarNivelConfirmar(index);
                });
            });
        }

        function guardarNivel(index) {
            const nivel = sistema.configuracion.nivelesMediadores[index];
            if (!nivel) return;
            
            const inputNombre = document.querySelector(`.editar-nivel-nombre[data-index="${index}"]`);
            const inputPuntos = document.querySelector(`.editar-nivel-puntos[data-index="${index}"]`);
            const inputBonus = document.querySelector(`.editar-nivel-bonus[data-index="${index}"]`);
            const inputDesc = document.querySelector(`.editar-nivel-desc[data-index="${index}"]`);
            
            if (inputNombre) nivel.nombre = inputNombre.value.trim();
            if (inputPuntos) nivel.puntosMin = parseInt(inputPuntos.value) || 0;
            if (inputBonus) nivel.bonus = parseInt(inputBonus.value) || 0;
            if (inputDesc) nivel.descripcion = inputDesc.value.trim();
            
            // Ordenar por puntos m√≠nimos
            sistema.configuracion.nivelesMediadores.sort((a, b) => a.puntosMin - b.puntosMin);
            
            guardarDatos();
            actualizarMediadores();
            actualizarInterfazCompleta();
            mostrarNotificacion(`Nivel actualizado`);
        }

        function eliminarNivelConfirmar(index) {
            const nivel = sistema.configuracion.nivelesMediadores[index];
            if (!nivel || index === 0) return;
            
            mostrarConfirmacion(
                'Eliminar Nivel',
                `¬øEst√° seguro de eliminar el nivel "${nivel.nombre}"?`,
                function() {
                    sistema.configuracion.nivelesMediadores.splice(index, 1);
                    guardarDatos();
                    actualizarTablaNiveles();
                    actualizarMediadores();
                    actualizarInterfazCompleta();
                    mostrarNotificacion(`Nivel eliminado`, 'warning');
                }
            );
        }

        function actualizarTablaPremios() {
            const tablaPremiosIndividuales = document.getElementById('tabla-premios-individuales');
            const tablaPremiosColectivos = document.getElementById('tabla-premios-colectivos');
            
            if (tablaPremiosIndividuales) {
                tablaPremiosIndividuales.innerHTML = '';
                
                sistema.configuracion.premiosIndividuales.forEach((premio, index) => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td><input type="text" value="${premio.medalla}" data-index="${index}" class="editar-premio-ind-medalla" style="width: 50px; padding: 8px;"></td>
                        <td><input type="text" value="${premio.nombre}" data-index="${index}" class="editar-premio-ind-nombre" style="width: 100%; padding: 8px;"></td>
                        <td><input type="number" value="${premio.puntosMin}" data-index="${index}" class="editar-premio-ind-puntos" style="width: 100px; padding: 8px;" min="0"></td>
                        <td><input type="text" value="${premio.descripcion}" data-index="${index}" class="editar-premio-ind-desc" style="width: 100%; padding: 8px;"></td>
                        <td>
                            <button class="btn-small btn-warning guardar-premio-ind" data-index="${index}">üíæ Guardar</button>
                            <button class="btn-small btn-danger eliminar-premio-ind" data-index="${index}">üóëÔ∏è Eliminar</button>
                        </td>
                    `;
                    tablaPremiosIndividuales.appendChild(tr);
                });
                
                // Configurar eventos
                tablaPremiosIndividuales.querySelectorAll('.guardar-premio-ind').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        guardarPremioIndividual(index);
                    });
                });
                
                tablaPremiosIndividuales.querySelectorAll('.eliminar-premio-ind').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        eliminarPremioIndividualConfirmar(index);
                    });
                });
            }
            
            if (tablaPremiosColectivos) {
                tablaPremiosColectivos.innerHTML = '';
                
                sistema.configuracion.premiosColectivos.forEach((premio, index) => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td><input type="number" value="${premio.puntos}" data-index="${index}" class="editar-premio-col-puntos" style="width: 100px; padding: 8px;" min="0"></td>
                        <td><input type="text" value="${premio.premio}" data-index="${index}" class="editar-premio-col-nombre" style="width: 100%; padding: 8px;"></td>
                        <td><input type="text" value="${premio.descripcion}" data-index="${index}" class="editar-premio-col-desc" style="width: 100%; padding: 8px;"></td>
                        <td>
                            <button class="btn-small btn-warning guardar-premio-col" data-index="${index}">üíæ Guardar</button>
                            <button class="btn-small btn-danger eliminar-premio-col" data-index="${index}">üóëÔ∏è Eliminar</button>
                        </td>
                    `;
                    tablaPremiosColectivos.appendChild(tr);
                });
                
                // Configurar eventos
                tablaPremiosColectivos.querySelectorAll('.guardar-premio-col').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        guardarPremioColectivo(index);
                    });
                });
                
                tablaPremiosColectivos.querySelectorAll('.eliminar-premio-col').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        eliminarPremioColectivoConfirmar(index);
                    });
                });
            }
        }

        function guardarPremioIndividual(index) {
            const premio = sistema.configuracion.premiosIndividuales[index];
            if (!premio) return;
            
            const inputMedalla = document.querySelector(`.editar-premio-ind-medalla[data-index="${index}"]`);
            const inputNombre = document.querySelector(`.editar-premio-ind-nombre[data-index="${index}"]`);
            const inputPuntos = document.querySelector(`.editar-premio-ind-puntos[data-index="${index}"]`);
            const inputDesc = document.querySelector(`.editar-premio-ind-desc[data-index="${index}"]`);
            
            if (inputMedalla) premio.medalla = inputMedalla.value.trim();
            if (inputNombre) premio.nombre = inputNombre.value.trim();
            if (inputPuntos) premio.puntosMin = parseInt(inputPuntos.value) || 0;
            if (inputDesc) premio.descripcion = inputDesc.value.trim();
            
            // Ordenar por puntos m√≠nimos
            sistema.configuracion.premiosIndividuales.sort((a, b) => a.puntosMin - b.puntosMin);
            
            guardarDatos();
            actualizarContenidoInformacion();
            mostrarNotificacion('Premio individual actualizado');
        }

        function eliminarPremioIndividualConfirmar(index) {
            const premio = sistema.configuracion.premiosIndividuales[index];
            if (!premio) return;
            
            mostrarConfirmacion(
                'Eliminar Premio',
                `¬øEst√° seguro de eliminar el premio "${premio.nombre}"?`,
                function() {
                    sistema.configuracion.premiosIndividuales.splice(index, 1);
                    guardarDatos();
                    actualizarTablaPremios();
                    actualizarContenidoInformacion();
                    mostrarNotificacion('Premio eliminado', 'warning');
                }
            );
        }

        function guardarPremioColectivo(index) {
            const premio = sistema.configuracion.premiosColectivos[index];
            if (!premio) return;
            
            const inputPuntos = document.querySelector(`.editar-premio-col-puntos[data-index="${index}"]`);
            const inputNombre = document.querySelector(`.editar-premio-col-nombre[data-index="${index}"]`);
            const inputDesc = document.querySelector(`.editar-premio-col-desc[data-index="${index}"]`);
            
            if (inputPuntos) premio.puntos = parseInt(inputPuntos.value) || 0;
            if (inputNombre) premio.premio = inputNombre.value.trim();
            if (inputDesc) premio.descripcion = inputDesc.value.trim();
            
            // Ordenar por puntos
            sistema.configuracion.premiosColectivos.sort((a, b) => a.puntos - b.puntos);
            
            guardarDatos();
            actualizarContenidoInformacion();
            mostrarNotificacion('Premio colectivo actualizado');
        }

        function eliminarPremioColectivoConfirmar(index) {
            const premio = sistema.configuracion.premiosColectivos[index];
            if (!premio) return;
            
            mostrarConfirmacion(
                'Eliminar Premio',
                `¬øEst√° seguro de eliminar el premio "${premio.premio}"?`,
                function() {
                    sistema.configuracion.premiosColectivos.splice(index, 1);
                    guardarDatos();
                    actualizarTablaPremios();
                    actualizarContenidoInformacion();
                    mostrarNotificacion('Premio eliminado', 'warning');
                }
            );
        }

        function actualizarEstadisticasSistema() {
            const estadisticasDiv = document.getElementById('estadisticas-sistema');
            if (!estadisticasDiv) return;
            
            let totalEstudiantes = 0;
            let totalRegistros = sistema.registros.length;
            let totalCursos = Object.keys(sistema.cursos).length;
            let totalMediadores = sistema.mediadores.length;
            
            Object.values(sistema.estudiantes).forEach(estudiantesCurso => {
                if (estudiantesCurso && Array.isArray(estudiantesCurso)) {
                    totalEstudiantes += estudiantesCurso.length;
                }
            });
            
            estadisticasDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                    <div style="text-align: center;">
                        <div style="font-size: 1.8rem; font-weight: bold; color: var(--primary);">${totalCursos}</div>
                        <div style="font-size: 0.9rem; color: #7f8c8d;">Cursos</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 1.8rem; font-weight: bold; color: var(--primary);">${totalEstudiantes}</div>
                        <div style="font-size: 0.9rem; color: #7f8c8d;">Estudiantes</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 1.8rem; font-weight: bold; color: var(--primary);">${totalRegistros}</div>
                        <div style="font-size: 0.9rem; color: #7f8c8d;">Registros</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 1.8rem; font-weight: bold; color: var(--primary);">${totalMediadores}</div>
                        <div style="font-size: 0.9rem; color: #7f8c8d;">Mediadores</div>
                    </div>
                </div>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                    <p><small>√öltima actualizaci√≥n: ${new Date().toLocaleString()}</small></p>
                </div>
            `;
        }

        // ============================================
        // INICIALIZACI√ìN DEL SISTEMA
        // ============================================
        window.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Inicializando Sistema de Convivencia...');
            
            // Cargar datos
            cargarDatos();
            
            // Inicializar componentes
            inicializarSistemaPIN();
            inicializarTabs();
            inicializarModal();
            inicializarRegistroIndividual();
            inicializarEvaluacionColectiva();
            
            // Actualizar interfaz
            actualizarInterfazCompleta();
            
            // Configurar bot√≥n de actualizar ranking
            const btnActualizarRanking = document.getElementById('btn-actualizar-ranking');
            if (btnActualizarRanking) {
                btnActualizarRanking.addEventListener('click', function() {
                    actualizarRankingCursos();
                    mostrarNotificacion('Ranking de cursos actualizado', 'success');
                });
            }
            
            // Configurar eventos de configuraci√≥n
            const btnAgregarCurso = document.getElementById('btn-agregar-curso');
            if (btnAgregarCurso) {
                btnAgregarCurso.addEventListener('click', function() {
                    const codigo = document.getElementById('nuevo-curso-codigo').value.trim().toUpperCase();
                    const nombre = document.getElementById('nuevo-curso-nombre').value.trim();
                    
                    if (!codigo || !nombre) {
                        mostrarNotificacion('Complete ambos campos', 'error');
                        return;
                    }
                    
                    if (sistema.cursos[codigo]) {
                        mostrarNotificacion('El c√≥digo de curso ya existe', 'error');
                        return;
                    }
                    
                    sistema.cursos[codigo] = {
                        nombre: nombre,
                        puntosColectivos: 0,
                        evaluaciones: []
                    };
                    
                    sistema.estudiantes[codigo] = [];
                    
                    document.getElementById('nuevo-curso-codigo').value = '';
                    document.getElementById('nuevo-curso-nombre').value = '';
                    
                    guardarDatos();
                    actualizarInterfazCompleta();
                    mostrarNotificacion(`Curso ${nombre} agregado correctamente`);
                });
            }
            
            const btnAgregarEstudiante = document.getElementById('btn-agregar-estudiante');
            if (btnAgregarEstudiante) {
                btnAgregarEstudiante.addEventListener('click', function() {
                    const codigoCurso = document.getElementById('curso-estudiante').value;
                    const nombre = document.getElementById('nuevo-estudiante-nombre').value.trim();
                    
                    if (!codigoCurso || !nombre) {
                        mostrarNotificacion('Seleccione un curso y escriba un nombre', 'error');
                        return;
                    }
                    
                    const estudiantesCurso = sistema.estudiantes[codigoCurso] || [];
                    const nuevoId = `${codigoCurso}-${estudiantesCurso.length + 1}`;
                    
                    estudiantesCurso.push({
                        id: nuevoId,
                        nombre: nombre,
                        puntos: 0
                    });
                    
                    sistema.estudiantes[codigoCurso] = estudiantesCurso;
                    
                    document.getElementById('nuevo-estudiante-nombre').value = '';
                    
                    guardarDatos();
                    actualizarInterfazCompleta();
                    mostrarNotificacion(`Estudiante ${nombre} agregado al curso ${codigoCurso}`);
                });
            }
            
            const btnAgregarCodigo = document.getElementById('btn-agregar-codigo');
            if (btnAgregarCodigo) {
                btnAgregarCodigo.addEventListener('click', function() {
                    const codigo = prompt('Ingrese el c√≥digo (2 letras, ej: NV):');
                    if (!codigo || codigo.length !== 2) {
                        mostrarNotificacion('El c√≥digo debe tener 2 letras', 'error');
                        return;
                    }
                    
                    if (sistema.configuracion.puntosCodigos[codigo]) {
                        mostrarNotificacion('El c√≥digo ya existe', 'error');
                        return;
                    }
                    
                    const nombre = prompt('Ingrese el nombre del c√≥digo:');
                    if (!nombre) {
                        mostrarNotificacion('Debe ingresar un nombre', 'error');
                        return;
                    }
                    
                    const tipo = prompt('Ingrese el tipo (positiva/negativa):', 'positiva');
                    if (tipo !== 'positiva' && tipo !== 'negativa') {
                        mostrarNotificacion('Tipo debe ser "positiva" o "negativa"', 'error');
                        return;
                    }
                    
                    const puntos = parseInt(prompt('Ingrese los puntos INDIVIDUALES:', tipo === 'positiva' ? '5' : '-5'));
                    if (isNaN(puntos)) {
                        mostrarNotificacion('Puntos deben ser un n√∫mero', 'error');
                        return;
                    }
                    
                    const descripcion = prompt('Ingrese la descripci√≥n:', '');
                    
                    sistema.configuracion.puntosCodigos[codigo] = {
                        nombre: nombre,
                        puntos: puntos,
                        tipo: tipo,
                        descripcion: descripcion || ''
                    };
                    
                    guardarDatos();
                    actualizarInterfazCompleta();
                    mostrarNotificacion(`C√≥digo ${codigo} agregado`);
                });
            }
            
            const btnAgregarPremioIndividual = document.getElementById('btn-agregar-premio-individual');
            if (btnAgregarPremioIndividual) {
                btnAgregarPremioIndividual.addEventListener('click', function() {
                    sistema.configuracion.premiosIndividuales.push({
                        medalla: 'üèÖ',
                        nombre: 'Nuevo Premio',
                        puntosMin: 0,
                        descripcion: 'Descripci√≥n del premio'
                    });
                    
                    guardarDatos();
                    actualizarTablaPremios();
                    actualizarContenidoInformacion();
                    mostrarNotificacion('Premio individual agregado');
                });
            }
            
            const btnAgregarPremioColectivo = document.getElementById('btn-agregar-premio-colectivo');
            if (btnAgregarPremioColectivo) {
                btnAgregarPremioColectivo.addEventListener('click', function() {
                    sistema.configuracion.premiosColectivos.push({
                        puntos: 0,
                        premio: 'Nuevo Premio',
                        descripcion: 'Descripci√≥n del premio'
                    });
                    
                    guardarDatos();
                    actualizarTablaPremios();
                    actualizarContenidoInformacion();
                    mostrarNotificacion('Premio colectivo agregado');
                });
            }
            
            // Configurar filtro de estudiantes
            const filtroCursoEstudiantes = document.getElementById('filtro-curso-estudiantes');
            if (filtroCursoEstudiantes) {
                filtroCursoEstudiantes.addEventListener('change', actualizarTablaEstudiantes);
            }
            
            console.log('‚úÖ Sistema de Convivencia inicializado correctamente');
            mostrarNotificacion('Sistema listo para usar', 'info');
        });
    </script>
</body>
</html>
